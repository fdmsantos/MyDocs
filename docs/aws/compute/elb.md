# Monitoring

## Cloudwatch Metrics

* ActiveConnectionCount
* HealthyHostCount, UnHealthyHostCount, HostCount
* BackendConnectionErrors
    - The count of the number of connections that were NOT successfully established between the Load Balancer and the registered instance
    - Average stat is most useful
    - Will report errors for all AZ's
    - Could indicate an issue with the web server
* HTTPCode_Backend_2XX,3XX,4XX,5XX
    - Generated by registered instances
* HTTPCode_ELB_4XX,5XX
    - Generated by Load Balancer
* ActiveFlowCount (Network Load Balancer)
* Metrics for performance
    - Latency
        - Measures the time elapsed (in seconds) after the request leaves the Load Balancer until the response is received
        - Average stat is most useful
        - Will report latency for all AZs
        - Page Load Time
    - RequestCount
        - Number of requests completed/connections made during specified interval (1 or 5 mins)
    - SurgeQueueLenght (Classic only)
        - A count of the total number of requests that are pending submissions to a registered instance
        - Max queue size is 1024
        - Additional requests will be rejected
        - Scaling up instances to ensure that never increases beyond the maximum queue capacity
    - SpilloverCount (Classic only)
        - Number of requests rejected because the surge queue is full
        - Direct consequence of a surge queue length increase
        - Should monitor SpilloverCount and SurgeQueueLenght
    - High numbers in these metrics can indicate a performance issue, need to scale infrastructure, etc
    
    
## ALB Error Messages

* 4XX - Client Side Errors - Problem with client request
    * 400 - Bad / malformed request - e.g header is malformed
    * 401 - Unauthorized - user access denied
    * 403 - Forbidden - request is blocked by WAF access control list
    * 460 - Client closed connection before the load balancer could respond, client timeout period my be too short
    * 463 - Load balancer received an X-Forwarded-For request header with >30 IP address - similar to a malformed request

* 5XX - Server side Errors - Server side Errors - Identify and fix the problem with your webserver/application/databases/load balancers
    * 500 - Internal server error - e.g error on the load balancer
    * 502- Bad Gateway - e.g. application server closed the connection or sent back a malformed responde
    * 503 - Service Unavailable - no registered targets
    * 504 - Gateway timeout - e.g. application is not responding - problem with your web server, application server or database
    * 561 - Unauthorized - received an error code from the ID provider when trying to authenticate as user
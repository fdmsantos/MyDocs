



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="My Docs">
      
      
      
        <meta name="author" content="Fábio Santos">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.1">
    
    
      
        <title>Windows - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.3020aac5.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../../../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="https://cdn.rawgit.com/knsv/mermaid/0.5.6/dist/mermaid.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#migrate-windows-workloads" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../.." title="My Docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              My Docs
            </span>
            <span class="md-header-nav__topic">
              Windows
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../../.." title="Index" class="md-tabs__link">
        Index
      </a>
    
  </li>

      
        
  
  
    
    
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../compute/ec2/" title="Platforms" class="md-tabs__link">
          Platforms
        </a>
      
    </li>
  

  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../devops/terraform/" title="DevOps" class="md-tabs__link">
          DevOps
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../databases/elasticsearch/search/" title="Databases" class="md-tabs__link">
          Databases
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../developer/python/packages/" title="Developer" class="md-tabs__link">
          Developer
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../certifications/kubernetes/ckad/" title="Certifications" class="md-tabs__link">
          Certifications
        </a>
      
    </li>
  

  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../.." title="My Docs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../.." title="Index" class="md-nav__link">
      Index
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Platforms
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Platforms
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" checked>
    
    <label class="md-nav__link" for="nav-2-1">
      AWS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        AWS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1-1" type="checkbox" id="nav-2-1-1">
    
    <label class="md-nav__link" for="nav-2-1-1">
      Compute
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-1">
        Compute
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../compute/ec2/" title="EC2" class="md-nav__link">
      EC2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../compute/ebs/" title="EBS" class="md-nav__link">
      EBS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../compute/elb/" title="ELB" class="md-nav__link">
      ELB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../compute/eks/" title="EKS" class="md-nav__link">
      EKS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1-2" type="checkbox" id="nav-2-1-2">
    
    <label class="md-nav__link" for="nav-2-1-2">
      Severless
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-2">
        Severless
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/lambda/" title="Lambda" class="md-nav__link">
      Lambda
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/apigateway/" title="ApiGateway" class="md-nav__link">
      ApiGateway
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/amplify/" title="Amplify" class="md-nav__link">
      Amplify
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/cognito/" title="Cognito" class="md-nav__link">
      Cognito
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/stepfunctions/" title="StepFunctions" class="md-nav__link">
      StepFunctions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1-3" type="checkbox" id="nav-2-1-3">
    
    <label class="md-nav__link" for="nav-2-1-3">
      Databases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-3">
        Databases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../databases/rds/" title="RDS" class="md-nav__link">
      RDS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../databases/dynamodb/" title="DynamoDB" class="md-nav__link">
      DynamoDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../databases/elasticache/" title="Elasticache" class="md-nav__link">
      Elasticache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../databases/redshift/" title="Redshift" class="md-nav__link">
      Redshift
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1-4" type="checkbox" id="nav-2-1-4">
    
    <label class="md-nav__link" for="nav-2-1-4">
      DevOps
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-4">
        DevOps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/cloudwatch/" title="CloudWatch" class="md-nav__link">
      CloudWatch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/cloudformation/" title="Cloudformation" class="md-nav__link">
      Cloudformation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1-5" type="checkbox" id="nav-2-1-5">
    
    <label class="md-nav__link" for="nav-2-1-5">
      Storage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-5">
        Storage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage/s3/" title="S3" class="md-nav__link">
      S3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1-6" type="checkbox" id="nav-2-1-6">
    
    <label class="md-nav__link" for="nav-2-1-6">
      Security
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-6">
        Security
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../security/acm/" title="ACM" class="md-nav__link">
      ACM
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1-7" type="checkbox" id="nav-2-1-7" checked>
    
    <label class="md-nav__link" for="nav-2-1-7">
      Migrate
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-7">
        Migrate
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../vmware/" title="VmWare" class="md-nav__link">
      VmWare
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Windows
      </label>
    
    <a href="./" title="Windows" class="md-nav__link md-nav__link--active">
      Windows
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#applications" title="Applications" class="md-nav__link">
    Applications
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-trust-relationship-between-aws-managed-ad-and-on-premise-ad-with-fsx" title="Lab - Trust Relationship between AWS Managed AD and On-Premise AD with FSX" class="md-nav__link">
    Lab - Trust Relationship between AWS Managed AD and On-Premise AD with FSX
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloudformation" title="Cloudformation" class="md-nav__link">
    Cloudformation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" title="Parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vpcstack" title="VPCStack" class="md-nav__link">
    VPCStack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#managedadstack" title="ManagedADStack" class="md-nav__link">
    ManagedADStack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adstack" title="ADStack" class="md-nav__link">
    ADStack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-cloud-endure" title="Lab CLoud Endure" class="md-nav__link">
    Lab CLoud Endure
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sqlserver/" title="SqlServer" class="md-nav__link">
      SqlServer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../apsnet.net" title="Aspnet" class="md-nav__link">
      Aspnet
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Kubernetes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Kubernetes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2-1" type="checkbox" id="nav-2-2-1">
    
    <label class="md-nav__link" for="nav-2-2-1">
      Admin
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-2-1">
        Admin
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/admin/admin/" title="Administrator" class="md-nav__link">
      Administrator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/admin/etcd/" title="Etcd" class="md-nav__link">
      Etcd
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/admin/kubecontrollermanager/" title="KubeControllerManager" class="md-nav__link">
      KubeControllerManager
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/admin/monitoring/" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/admin/networking/" title="Networking" class="md-nav__link">
      Networking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/admin/security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/admin/hardway/" title="Hardway" class="md-nav__link">
      Hardway
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/admin/kops/" title="Kops" class="md-nav__link">
      Kops
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2-2" type="checkbox" id="nav-2-2-2">
    
    <label class="md-nav__link" for="nav-2-2-2">
      Developer
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-2-2">
        Developer
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/developer/pods/" title="Pods" class="md-nav__link">
      Pods
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/developer/daemonsets/" title="DaemonSets" class="md-nav__link">
      DaemonSets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/developer/deployments/" title="Deployments" class="md-nav__link">
      Deployments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/developer/ingress/" title="Ingress" class="md-nav__link">
      Ingress
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/developer/jobs/" title="Jobs" class="md-nav__link">
      Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/developer/volumes/" title="Volumes" class="md-nav__link">
      Volumes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/developer/replicasets/" title="Replicasets" class="md-nav__link">
      Replicasets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/developer/secrets_configmaps/" title="Secrets&ConfigMaps" class="md-nav__link">
      Secrets&ConfigMaps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/developer/services/" title="Services" class="md-nav__link">
      Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes/developer/statefulsets/" title="StatefulSets" class="md-nav__link">
      StatefulSets
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Unix
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Unix
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix/commands/" title="Commands" class="md-nav__link">
      Commands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix/disks/" title="Disks" class="md-nav__link">
      Disks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix/networking/" title="Networking" class="md-nav__link">
      Networking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix/security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix/redhat/" title="Redhat" class="md-nav__link">
      Redhat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix/debian/" title="Debian" class="md-nav__link">
      Debian
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix/archlinux/" title="Archlinux" class="md-nav__link">
      Archlinux
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix/virsh/" title="Virsh" class="md-nav__link">
      Virsh
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      DevOps
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        DevOps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../devops/terraform/" title="Terraform" class="md-nav__link">
      Terraform
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../devops/packer/" title="Packer" class="md-nav__link">
      Packer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../devops/git/" title="Git" class="md-nav__link">
      Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../devops/jenkins/" title="Jenkins" class="md-nav__link">
      Jenkins
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Databases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Databases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      ElasticSearch
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        ElasticSearch
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/elasticsearch/search/" title="Search" class="md-nav__link">
      Search
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/elasticsearch/indices/" title="Indices" class="md-nav__link">
      Indices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/elasticsearch/cat/" title="Cat" class="md-nav__link">
      Cat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/elasticsearch/beat/" title="Beat" class="md-nav__link">
      Beat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/elasticsearch/kibana/" title="Kibana" class="md-nav__link">
      Kibana
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/elasticsearch/cluster/" title="Cluster" class="md-nav__link">
      Cluster
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/elasticsearch/nodes/" title="Nodes" class="md-nav__link">
      Nodes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/elasticsearch/snapshots/" title="Snapshots" class="md-nav__link">
      Snapshots
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      MySQL
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        MySQL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/mysql/galera-cluster/" title="Galera" class="md-nav__link">
      Galera
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Developer
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Developer
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1">
    
    <label class="md-nav__link" for="nav-5-1">
      Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/python/packages/" title="Packages" class="md-nav__link">
      Packages
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/ciscoAci/cobra/" title="Cisco ACI" class="md-nav__link">
      Cisco ACI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      RobotFramework
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        RobotFramework
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/robotframework/gettingstarted/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/robotframework/ddd/" title="Data-Driver" class="md-nav__link">
      Data-Driver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/robotframework/pom/" title="Page-Object Model" class="md-nav__link">
      Page-Object Model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/robotframework/robotfile/" title="RobotFile" class="md-nav__link">
      RobotFile
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/robotframework/selenium/" title="Selenium" class="md-nav__link">
      Selenium
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4">
    
    <label class="md-nav__link" for="nav-5-4">
      CSS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-4">
        CSS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/css/vom/" title="VOM" class="md-nav__link">
      VOM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/css/flexbox/" title="Flexbox" class="md-nav__link">
      Flexbox
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/css/cssgrid/" title="Grid" class="md-nav__link">
      Grid
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Certifications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Certifications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-1" type="checkbox" id="nav-6-1">
    
    <label class="md-nav__link" for="nav-6-1">
      Kubernetes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-1">
        Kubernetes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/kubernetes/ckad/" title="CKAD" class="md-nav__link">
      CKAD
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      AWS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-2">
        AWS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/aws/security-specialty/" title="Security-Specialty" class="md-nav__link">
      Security-Specialty
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/aws/bigdata-specialty/" title="Big-Data" class="md-nav__link">
      Big-Data
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-3" type="checkbox" id="nav-6-3">
    
    <label class="md-nav__link" for="nav-6-3">
      Google
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-3">
        Google
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/google/associate-cloud-engineer/" title="Associate-Cloud-Engineer" class="md-nav__link">
      Associate-Cloud-Engineer
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-4" type="checkbox" id="nav-6-4">
    
    <label class="md-nav__link" for="nav-6-4">
      Azure
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-4">
        Azure
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/azure/fundamentals/" title="Fundamentals" class="md-nav__link">
      Fundamentals
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#applications" title="Applications" class="md-nav__link">
    Applications
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-trust-relationship-between-aws-managed-ad-and-on-premise-ad-with-fsx" title="Lab - Trust Relationship between AWS Managed AD and On-Premise AD with FSX" class="md-nav__link">
    Lab - Trust Relationship between AWS Managed AD and On-Premise AD with FSX
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloudformation" title="Cloudformation" class="md-nav__link">
    Cloudformation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" title="Parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vpcstack" title="VPCStack" class="md-nav__link">
    VPCStack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#managedadstack" title="ManagedADStack" class="md-nav__link">
    ManagedADStack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adstack" title="ADStack" class="md-nav__link">
    ADStack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-cloud-endure" title="Lab CLoud Endure" class="md-nav__link">
    Lab CLoud Endure
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="migrate-windows-workloads">Migrate Windows Workloads<a class="headerlink" href="#migrate-windows-workloads" title="Permanent link">&para;</a></h1>
<h2 id="applications">Applications<a class="headerlink" href="#applications" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>CloudEndure</p>
</li>
<li>
<p>AWS Server Migration Server -&gt; Create AMIS</p>
</li>
</ul>
<p><img alt="Diagram" src="../../../../img/screenshot.201.jpg" /></p>
<h2 id="lab-trust-relationship-between-aws-managed-ad-and-on-premise-ad-with-fsx">Lab - Trust Relationship between AWS Managed AD and On-Premise AD with FSX<a class="headerlink" href="#lab-trust-relationship-between-aws-managed-ad-and-on-premise-ad-with-fsx" title="Permanent link">&para;</a></h2>
<p><a href="https://winonaws.cloud/migratewindows/en/">Lab Guide</a></p>
<p>AWS Support Contact: Hans Moser - <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#104;&#97;&#110;&#115;&#109;&#111;&#115;&#101;&#64;&#97;&#109;&#97;&#122;&#111;&#110;&#46;&#99;&#104;">&#104;&#97;&#110;&#115;&#109;&#111;&#115;&#101;&#64;&#97;&#109;&#97;&#122;&#111;&#110;&#46;&#99;&#104;</a></p>
<ul>
<li>
<p>Hans Moser - Info About D: Drive</p>
<ul>
<li>Regarding D: Drive: In our ‘source Fileserver’ we have the files on C:, hence the first export also include the directory paths to C:</li>
<li>But on FSX, our target, the data drive is D:  So to make the import work, we’ve to change the paths, so that we target the correct folder paths on the destination (our FSX).</li>
</ul>
</li>
</ul>
<h3 id="cloudformation">Cloudformation<a class="headerlink" href="#cloudformation" title="Permanent link">&para;</a></h3>
<h4 id="parameters">Parameters<a class="headerlink" href="#parameters" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>ADServer1InstanceType</td>
<td>m5.large</td>
</tr>
<tr>
<td>ADServer1NetBIOSName</td>
<td>DC1</td>
</tr>
<tr>
<td>ADServer1PrivateIP</td>
<td>10.0.0.10</td>
</tr>
<tr>
<td>ASGInstanceType</td>
<td>m5.large</td>
</tr>
<tr>
<td>ASGSize</td>
<td>2</td>
</tr>
<tr>
<td>AvailabilityZones</td>
<td>us-west-2a,us-west-2b</td>
</tr>
<tr>
<td>DemoInstances</td>
<td>No</td>
</tr>
<tr>
<td>DeployManagedAD</td>
<td>Yes</td>
</tr>
<tr>
<td>DomainAdminPassword</td>
<td>****</td>
</tr>
<tr>
<td>DomainAdminUser</td>
<td>Admin</td>
</tr>
<tr>
<td>DomainDNSName</td>
<td>example.com</td>
</tr>
<tr>
<td>DomainNetBIOSName</td>
<td>example</td>
</tr>
<tr>
<td>ManagedADEdition</td>
<td>Standard</td>
</tr>
<tr>
<td>ManagedDomainDNSName</td>
<td>managedexample.com</td>
</tr>
<tr>
<td>ManagedDomainNetBIOSName</td>
<td>managedexample</td>
</tr>
<tr>
<td>NumberOfAZs</td>
<td>2</td>
</tr>
<tr>
<td>PrivateSubnet1CIDR</td>
<td>10.0.0.0/19</td>
</tr>
<tr>
<td>PrivateSubnet2CIDR</td>
<td>10.0.32.0/19</td>
</tr>
<tr>
<td>PrivateSubnet3CIDR</td>
<td>-</td>
</tr>
<tr>
<td>PublicSubnet1CIDR</td>
<td>10.0.128.0/20</td>
</tr>
<tr>
<td>PublicSubnet2CIDR</td>
<td>10.0.144.0/20</td>
</tr>
<tr>
<td>PublicSubnet3CIDR</td>
<td>-</td>
</tr>
<tr>
<td>QSS3BucketName</td>
<td>alpublic</td>
</tr>
<tr>
<td>QSS3KeyPrefix</td>
<td>quickstart-microsoft-activedirectory/</td>
</tr>
<tr>
<td>SrvInstanceType</td>
<td>t3.large</td>
</tr>
<tr>
<td>VPCCIDR</td>
<td>10.0.0.0/16</td>
</tr>
</tbody>
</table>
<h3 id="vpcstack">VPCStack<a class="headerlink" href="#vpcstack" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;AWSTemplateFormatVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;2010-09-09&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;This template creates a Multi-AZ, multi-subnet VPC infrastructure with managed NAT gateways in the public subnet for each Availability Zone. You can also create additional private subnets with dedicated custom network access control lists (ACLs). If you deploy the Quick Start in a region that doesn&#39;t support NAT gateways, NAT instances are deployed instead. **WARNING** This template creates AWS resources. You will be billed for the AWS resources used if you create a stack from this template. QS(0027)&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;AWS::CloudFormation::Interface&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;ParameterGroups&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Label&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Availability Zone Configuration&quot;</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;Parameters&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;AvailabilityZones&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;NumberOfAZs&quot;</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Label&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Configuration&quot;</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;Parameters&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;VPCCIDR&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PublicSubnet1CIDR&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PublicSubnet2CIDR&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PublicSubnet3CIDR&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PublicSubnet4CIDR&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PublicSubnetTag1&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PublicSubnetTag2&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PublicSubnetTag3&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;CreatePrivateSubnets&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PrivateSubnet1ACIDR&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PrivateSubnet2ACIDR&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PrivateSubnet3ACIDR&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PrivateSubnet4ACIDR&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PrivateSubnetATag1&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PrivateSubnetATag2&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PrivateSubnetATag3&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;CreateAdditionalPrivateSubnets&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PrivateSubnet1BCIDR&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PrivateSubnet2BCIDR&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PrivateSubnet3BCIDR&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PrivateSubnet4BCIDR&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PrivateSubnetBTag1&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PrivateSubnetBTag2&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PrivateSubnetBTag3&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;VPCTenancy&quot;</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Label&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Deprecated: NAT Instance Configuration&quot;</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;Parameters&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;KeyPairName&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;NATInstanceType&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="nt">&quot;ParameterLabels&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;AvailabilityZones&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Availability Zones&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;CreateAdditionalPrivateSubnets&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Create additional private subnets with dedicated network ACLs&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;CreatePrivateSubnets&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Create private subnets&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;KeyPairName&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Deprecated: Key pair name&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;NATInstanceType&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Deprecated: NAT instance type&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;NumberOfAZs&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of Availability Zones&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PrivateSubnet1ACIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 1A CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PrivateSubnet1BCIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 1B with dedicated network ACL CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PrivateSubnet2ACIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 2A CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PrivateSubnet2BCIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 2B with dedicated network ACL CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PrivateSubnet3ACIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 3A CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PrivateSubnet3BCIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 3B with dedicated network ACL CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PrivateSubnet4ACIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 4A CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PrivateSubnet4BCIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 4B with dedicated network ACL CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PrivateSubnetATag1&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Tag for Private A Subnets&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PrivateSubnetATag2&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Tag for Private A Subnets&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PrivateSubnetATag3&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Tag for Private A Subnets&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PrivateSubnetBTag1&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Tag for Private B Subnets&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PrivateSubnetBTag2&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Tag for Private B Subnets&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PrivateSubnetBTag3&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Tag for Private B Subnets&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PublicSubnet1CIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet 1 CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PublicSubnet2CIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet 2 CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PublicSubnet3CIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet 3 CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PublicSubnet4CIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet 4 CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PublicSubnetTag1&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Tag for Public Subnets&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PublicSubnetTag2&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Tag for Public Subnets&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;PublicSubnetTag3&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Tag for Public Subnets&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;VPCCIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;VPCTenancy&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC Tenancy&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;Parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;AvailabilityZones&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;List of Availability Zones to use for the subnets in the VPC. Note: The logical order is preserved.&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;List&lt;AWS::EC2::AvailabilityZone::Name&gt;&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;CreateAdditionalPrivateSubnets&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedValues&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;true&quot;</span><span class="p">,</span>
                <span class="s2">&quot;false&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Set to true to create a network ACL protected subnet in each Availability Zone. If false, the CIDR parameters for those subnets will be ignored. If true, it also requires that the &#39;Create private subnets&#39; parameter is also true to have any effect.&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;CreatePrivateSubnets&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedValues&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;true&quot;</span><span class="p">,</span>
                <span class="s2">&quot;false&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Set to false to create only public subnets. If false, the CIDR parameters for ALL private subnets will be ignored.&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;KeyPairName&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Deprecated. NAT gateways are now supported in all regions.&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;deprecated&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;NATInstanceType&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;deprecated&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Deprecated. NAT gateways are now supported in all regions.&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;NumberOfAZs&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedValues&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;4&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of Availability Zones to use in the VPC. This must match your selections in the list of Availability Zones parameter.&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1ACIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block parameter must be in the form x.x.x.x/16-28&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.0/19&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block for private subnet 1A located in Availability Zone 1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1BCIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block parameter must be in the form x.x.x.x/16-28&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.192.0/21&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block for private subnet 1B with dedicated network ACL located in Availability Zone 1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2ACIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block parameter must be in the form x.x.x.x/16-28&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.32.0/19&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block for private subnet 2A located in Availability Zone 2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2BCIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block parameter must be in the form x.x.x.x/16-28&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.200.0/21&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block for private subnet 2B with dedicated network ACL located in Availability Zone 2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3ACIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block parameter must be in the form x.x.x.x/16-28&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.64.0/19&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block for private subnet 3A located in Availability Zone 3&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3BCIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block parameter must be in the form x.x.x.x/16-28&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.208.0/21&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block for private subnet 3B with dedicated network ACL located in Availability Zone 3&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4ACIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block parameter must be in the form x.x.x.x/16-28&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.96.0/19&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block for private subnet 4A located in Availability Zone 4&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4BCIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block parameter must be in the form x.x.x.x/16-28&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.216.0/21&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block for private subnet 4B with dedicated network ACL located in Availability Zone 4&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnetATag1&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^([a-zA-Z0-9+\\-._:/@]+=[a-zA-Z0-9+\\-.,_:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]*)?$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;tags must be in format \&quot;Key=Value\&quot; keys can only contain [a-zA-Z0-9+\\-._:/@], values can contain [a-zA-Z0-9+\\-._:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;Network=Private&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;tag to add to private subnets A, in format Key=Value (Optional)&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnetATag2&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^([a-zA-Z0-9+\\-._:/@]+=[a-zA-Z0-9+\\-.,_:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]*)?$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;tags must be in format \&quot;Key=Value\&quot; keys can only contain [a-zA-Z0-9+\\-._:/@], values can contain [a-zA-Z0-9+\\-._:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;tag to add to private subnets A, in format Key=Value (Optional)&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnetATag3&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^([a-zA-Z0-9+\\-._:/@]+=[a-zA-Z0-9+\\-.,_:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]*)?$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;tags must be in format \&quot;Key=Value\&quot; keys can only contain [a-zA-Z0-9+\\-._:/@], values can contain [a-zA-Z0-9+\\-._:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;tag to add to private subnets A, in format Key=Value (Optional)&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnetBTag1&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^([a-zA-Z0-9+\\-._:/@]+=[a-zA-Z0-9+\\-.,_:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]*)?$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;tags must be in format \&quot;Key=Value\&quot; keys can only contain [a-zA-Z0-9+\\-._:/@], values can contain [a-zA-Z0-9+\\-._:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;Network=Private&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;tag to add to private subnets B, in format Key=Value (Optional)&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnetBTag2&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^([a-zA-Z0-9+\\-._:/@]+=[a-zA-Z0-9+\\-.,_:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]*)?$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;tags must be in format \&quot;Key=Value\&quot; keys can only contain [a-zA-Z0-9+\\-._:/@], values can contain [a-zA-Z0-9+\\-._:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;tag to add to private subnets B, in format Key=Value (Optional)&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnetBTag3&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^([a-zA-Z0-9+\\-._:/@]+=[a-zA-Z0-9+\\-.,_:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]*)?$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;tags must be in format \&quot;Key=Value\&quot; keys can only contain [a-zA-Z0-9+\\-._:/@], values can contain [a-zA-Z0-9+\\-._:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;tag to add to private subnets B, in format Key=Value (Optional)&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet1CIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block parameter must be in the form x.x.x.x/16-28&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.128.0/20&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block for the public DMZ subnet 1 located in Availability Zone 1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet2CIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block parameter must be in the form x.x.x.x/16-28&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.144.0/20&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block for the public DMZ subnet 2 located in Availability Zone 2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet3CIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block parameter must be in the form x.x.x.x/16-28&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.160.0/20&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block for the public DMZ subnet 3 located in Availability Zone 3&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet4CIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block parameter must be in the form x.x.x.x/16-28&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.176.0/20&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block for the public DMZ subnet 4 located in Availability Zone 4&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnetTag1&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^([a-zA-Z0-9+\\-._:/@]+=[a-zA-Z0-9+\\-.,_:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]*)?$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;tags must be in format \&quot;Key=Value\&quot; keys can only contain [a-zA-Z0-9+\\-._:/@], values can contain [a-zA-Z0-9+\\-._:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;Network=Public&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;tag to add to public subnets, in format Key=Value (Optional)&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnetTag2&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^([a-zA-Z0-9+\\-._:/@]+=[a-zA-Z0-9+\\-.,_:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]*)?$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;tags must be in format \&quot;Key=Value\&quot; keys can only contain [a-zA-Z0-9+\\-._:/@], values can contain [a-zA-Z0-9+\\-._:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;tag to add to public subnets, in format Key=Value (Optional)&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnetTag3&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^([a-zA-Z0-9+\\-._:/@]+=[a-zA-Z0-9+\\-.,_:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]*)?$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;tags must be in format \&quot;Key=Value\&quot; keys can only contain [a-zA-Z0-9+\\-._:/@], values can contain [a-zA-Z0-9+\\-._:/@ *\\\\\&quot;&#39;\\[\\]\\{\\}]&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;tag to add to public subnets, in format Key=Value (Optional)&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;VPCCIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedPattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$&quot;</span><span class="p">,</span>
            <span class="nt">&quot;ConstraintDescription&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block parameter must be in the form x.x.x.x/16-28&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.0/16&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;CIDR block for the VPC&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;VPCTenancy&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;AllowedValues&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;default&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dedicated&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;The allowed tenancy of instances launched into the VPC&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;Conditions&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;3AZCondition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::Or&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Fn::Equals&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;NumberOfAZs&quot;</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;3&quot;</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;4AZCondition&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;4AZCondition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::Equals&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;NumberOfAZs&quot;</span>
                <span class="p">},</span>
                <span class="s2">&quot;4&quot;</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::And&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Fn::Equals&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;CreatePrivateSubnets&quot;</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;true&quot;</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Fn::Equals&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;CreateAdditionalPrivateSubnets&quot;</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;true&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;AdditionalPrivateSubnets&amp;3AZCondition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::And&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;3AZCondition&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;AdditionalPrivateSubnets&amp;4AZCondition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::And&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;4AZCondition&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;GovCloudCondition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::Equals&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::Region&quot;</span>
                <span class="p">},</span>
                <span class="s2">&quot;us-gov-west-1&quot;</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;NVirginiaRegionCondition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::Equals&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::Region&quot;</span>
                <span class="p">},</span>
                <span class="s2">&quot;us-east-1&quot;</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnetsCondition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::Equals&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;CreatePrivateSubnets&quot;</span>
                <span class="p">},</span>
                <span class="s2">&quot;true&quot;</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnets&amp;3AZCondition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::And&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;3AZCondition&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnets&amp;4AZCondition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::And&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;4AZCondition&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnetATag1Condition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::Not&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Fn::Equals&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag1&quot;</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnetATag2Condition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::Not&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Fn::Equals&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag2&quot;</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnetATag3Condition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::Not&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Fn::Equals&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag3&quot;</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnetBTag1Condition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::Not&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Fn::Equals&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag1&quot;</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnetBTag2Condition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::Not&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Fn::Equals&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag2&quot;</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnetBTag3Condition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::Not&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Fn::Equals&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag3&quot;</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnetTag1Condition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::Not&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Fn::Equals&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag1&quot;</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnetTag2Condition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::Not&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Fn::Equals&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag2&quot;</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnetTag3Condition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Fn::Not&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;Fn::Equals&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag3&quot;</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;Resources&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;DHCPOptions&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::DHCPOptions&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;DomainName&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;NVirginiaRegionCondition&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;ec2.internal&quot;</span><span class="p">,</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::Region}.compute.internal&quot;</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;DomainNameServers&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;AmazonProvidedDNS&quot;</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;VPC&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::VPC&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPCCIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;InstanceTenancy&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPCTenancy&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;EnableDnsSupport&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="nt">&quot;EnableDnsHostnames&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::StackName&quot;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;VPCDHCPOptionsAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::VPCDHCPOptionsAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;DhcpOptionsId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;DHCPOptions&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;InternetGateway&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::InternetGateway&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::StackName&quot;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;VPCGatewayAttachment&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::VPCGatewayAttachment&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;InternetGatewayId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;InternetGateway&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1A&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Subnet&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1ACIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;AvailabilityZone&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AvailabilityZones&quot;</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 1A&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetATag1Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetATag2Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetATag3Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1B&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Subnet&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1BCIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;AvailabilityZone&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AvailabilityZones&quot;</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 1B&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetBTag1Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetBTag2Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetBTag3Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2A&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Subnet&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2ACIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;AvailabilityZone&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AvailabilityZones&quot;</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 2A&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetATag1Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetATag2Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetATag3Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2B&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Subnet&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2BCIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;AvailabilityZone&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AvailabilityZones&quot;</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 2B&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetBTag1Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetBTag2Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetBTag3Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3A&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Subnet&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3ACIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;AvailabilityZone&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;2&quot;</span><span class="p">,</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AvailabilityZones&quot;</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 3A&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetATag1Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetATag2Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetATag3Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3B&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Subnet&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3BCIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;AvailabilityZone&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;2&quot;</span><span class="p">,</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AvailabilityZones&quot;</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 3B&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetBTag1Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetBTag2Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetBTag3Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4A&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Subnet&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4ACIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;AvailabilityZone&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;3&quot;</span><span class="p">,</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AvailabilityZones&quot;</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 4A&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetATag1Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetATag2Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetATag3Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetATag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4B&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Subnet&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4BCIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;AvailabilityZone&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;3&quot;</span><span class="p">,</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AvailabilityZones&quot;</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 4B&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetBTag1Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetBTag2Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnetBTag3Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetBTag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet1&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Subnet&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet1CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;AvailabilityZone&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AvailabilityZones&quot;</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet 1&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PublicSubnetTag1Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PublicSubnetTag2Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PublicSubnetTag3Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="nt">&quot;MapPublicIpOnLaunch&quot;</span><span class="p">:</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet2&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Subnet&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet2CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;AvailabilityZone&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AvailabilityZones&quot;</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet 2&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PublicSubnetTag1Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PublicSubnetTag2Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PublicSubnetTag3Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="nt">&quot;MapPublicIpOnLaunch&quot;</span><span class="p">:</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet3&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Subnet&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet3CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;AvailabilityZone&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;2&quot;</span><span class="p">,</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AvailabilityZones&quot;</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet 3&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PublicSubnetTag1Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PublicSubnetTag2Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PublicSubnetTag3Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="nt">&quot;MapPublicIpOnLaunch&quot;</span><span class="p">:</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet4&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Subnet&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet4CIDR&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;AvailabilityZone&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;3&quot;</span><span class="p">,</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AvailabilityZones&quot;</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet 4&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PublicSubnetTag1Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag1&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PublicSubnetTag2Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag2&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PublicSubnetTag3Condition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">},</span>
                                <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;Fn::Select&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                        <span class="p">{</span>
                                            <span class="nt">&quot;Fn::Split&quot;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                                                <span class="p">{</span>
                                                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetTag3&quot;</span>
                                                <span class="p">}</span>
                                            <span class="p">]</span>
                                        <span class="p">}</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="nt">&quot;MapPublicIpOnLaunch&quot;</span><span class="p">:</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1ARouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::RouteTable&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 1A&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Network&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1ARoute&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Route&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1ARouteTable&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;DestinationCidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;NatGatewayId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;NATGateway1&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1ARouteTableAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::SubnetRouteTableAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1A&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1ARouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2ARouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::RouteTable&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 2A&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Network&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2ARoute&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Route&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2ARouteTable&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;DestinationCidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;NatGatewayId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;NATGateway2&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2ARouteTableAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::SubnetRouteTableAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2A&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2ARouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3ARouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::RouteTable&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 3A&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Network&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3ARoute&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Route&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3ARouteTable&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;DestinationCidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;NatGatewayId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;NATGateway3&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3ARouteTableAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::SubnetRouteTableAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3A&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3ARouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4ARouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::RouteTable&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 4A&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Network&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4ARoute&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Route&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4ARouteTable&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;DestinationCidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;NatGatewayId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;NATGateway4&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4ARouteTableAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::SubnetRouteTableAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4A&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4ARouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1BRouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::RouteTable&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 1B&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Network&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1BRoute&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Route&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1BRouteTable&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;DestinationCidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;NatGatewayId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;NATGateway1&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1BRouteTableAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::SubnetRouteTableAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1B&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1BRouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1BNetworkAcl&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::NetworkAcl&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;NACL Protected subnet 1&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Network&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;NACL Protected&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1BNetworkAclEntryInbound&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::NetworkAclEntry&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;Egress&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="nt">&quot;NetworkAclId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1BNetworkAcl&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Protocol&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
                <span class="nt">&quot;RuleAction&quot;</span><span class="p">:</span> <span class="s2">&quot;allow&quot;</span><span class="p">,</span>
                <span class="nt">&quot;RuleNumber&quot;</span><span class="p">:</span> <span class="mi">100</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1BNetworkAclEntryOutbound&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::NetworkAclEntry&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;Egress&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="nt">&quot;NetworkAclId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1BNetworkAcl&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Protocol&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
                <span class="nt">&quot;RuleAction&quot;</span><span class="p">:</span> <span class="s2">&quot;allow&quot;</span><span class="p">,</span>
                <span class="nt">&quot;RuleNumber&quot;</span><span class="p">:</span> <span class="mi">100</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1BNetworkAclAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::SubnetNetworkAclAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1B&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;NetworkAclId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1BNetworkAcl&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2BRouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::RouteTable&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 2B&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Network&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2BRoute&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Route&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2BRouteTable&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;DestinationCidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;NatGatewayId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;NATGateway2&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2BRouteTableAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::SubnetRouteTableAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2B&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2BRouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2BNetworkAcl&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::NetworkAcl&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;NACL Protected subnet 2&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Network&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;NACL Protected&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2BNetworkAclEntryInbound&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::NetworkAclEntry&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;Egress&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="nt">&quot;NetworkAclId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2BNetworkAcl&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Protocol&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
                <span class="nt">&quot;RuleAction&quot;</span><span class="p">:</span> <span class="s2">&quot;allow&quot;</span><span class="p">,</span>
                <span class="nt">&quot;RuleNumber&quot;</span><span class="p">:</span> <span class="mi">100</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2BNetworkAclEntryOutbound&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::NetworkAclEntry&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;Egress&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="nt">&quot;NetworkAclId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2BNetworkAcl&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Protocol&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
                <span class="nt">&quot;RuleAction&quot;</span><span class="p">:</span> <span class="s2">&quot;allow&quot;</span><span class="p">,</span>
                <span class="nt">&quot;RuleNumber&quot;</span><span class="p">:</span> <span class="mi">100</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2BNetworkAclAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::SubnetNetworkAclAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2B&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;NetworkAclId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2BNetworkAcl&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3BRouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::RouteTable&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 3B&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Network&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3BRoute&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Route&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3BRouteTable&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;DestinationCidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;NatGatewayId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;NATGateway3&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3BRouteTableAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::SubnetRouteTableAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3B&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3BRouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3BNetworkAcl&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::NetworkAcl&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;NACL Protected subnet 3&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Network&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;NACL Protected&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3BNetworkAclEntryInbound&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::NetworkAclEntry&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;Egress&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="nt">&quot;NetworkAclId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3BNetworkAcl&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Protocol&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
                <span class="nt">&quot;RuleAction&quot;</span><span class="p">:</span> <span class="s2">&quot;allow&quot;</span><span class="p">,</span>
                <span class="nt">&quot;RuleNumber&quot;</span><span class="p">:</span> <span class="mi">100</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3BNetworkAclEntryOutbound&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::NetworkAclEntry&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;Egress&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="nt">&quot;NetworkAclId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3BNetworkAcl&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Protocol&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
                <span class="nt">&quot;RuleAction&quot;</span><span class="p">:</span> <span class="s2">&quot;allow&quot;</span><span class="p">,</span>
                <span class="nt">&quot;RuleNumber&quot;</span><span class="p">:</span> <span class="mi">100</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3BNetworkAclAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::SubnetNetworkAclAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3B&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;NetworkAclId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3BNetworkAcl&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4BRouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::RouteTable&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 4B&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Network&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Private&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4BRoute&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Route&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4BRouteTable&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;DestinationCidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;NatGatewayId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;NATGateway4&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4BRouteTableAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::SubnetRouteTableAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4B&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4BRouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4BNetworkAcl&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::NetworkAcl&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;NACL Protected subnet 4&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Network&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;NACL Protected&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4BNetworkAclEntryInbound&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::NetworkAclEntry&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;Egress&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="nt">&quot;NetworkAclId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4BNetworkAcl&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Protocol&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
                <span class="nt">&quot;RuleAction&quot;</span><span class="p">:</span> <span class="s2">&quot;allow&quot;</span><span class="p">,</span>
                <span class="nt">&quot;RuleNumber&quot;</span><span class="p">:</span> <span class="mi">100</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4BNetworkAclEntryOutbound&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::NetworkAclEntry&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;CidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;Egress&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="nt">&quot;NetworkAclId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4BNetworkAcl&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Protocol&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
                <span class="nt">&quot;RuleAction&quot;</span><span class="p">:</span> <span class="s2">&quot;allow&quot;</span><span class="p">,</span>
                <span class="nt">&quot;RuleNumber&quot;</span><span class="p">:</span> <span class="mi">100</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4BNetworkAclAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::SubnetNetworkAclAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4B&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;NetworkAclId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4BNetworkAcl&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnetRouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::RouteTable&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Public Subnets&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;Network&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Public&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnetRoute&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;DependsOn&quot;</span><span class="p">:</span> <span class="s2">&quot;VPCGatewayAttachment&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::Route&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetRouteTable&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;DestinationCidrBlock&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;GatewayId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;InternetGateway&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet1RouteTableAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::SubnetRouteTableAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet1&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetRouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet2RouteTableAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::SubnetRouteTableAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet2&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetRouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet3RouteTableAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::SubnetRouteTableAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet3&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetRouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet4RouteTableAssociation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::SubnetRouteTableAssociation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet4&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;RouteTableId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetRouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;NAT1EIP&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;DependsOn&quot;</span><span class="p">:</span> <span class="s2">&quot;VPCGatewayAttachment&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::EIP&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Domain&quot;</span><span class="p">:</span> <span class="s2">&quot;vpc&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;NAT2EIP&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;DependsOn&quot;</span><span class="p">:</span> <span class="s2">&quot;VPCGatewayAttachment&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::EIP&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Domain&quot;</span><span class="p">:</span> <span class="s2">&quot;vpc&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;NAT3EIP&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;DependsOn&quot;</span><span class="p">:</span> <span class="s2">&quot;VPCGatewayAttachment&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::EIP&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Domain&quot;</span><span class="p">:</span> <span class="s2">&quot;vpc&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;NAT4EIP&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;DependsOn&quot;</span><span class="p">:</span> <span class="s2">&quot;VPCGatewayAttachment&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::EIP&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Domain&quot;</span><span class="p">:</span> <span class="s2">&quot;vpc&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;NATGateway1&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;DependsOn&quot;</span><span class="p">:</span> <span class="s2">&quot;VPCGatewayAttachment&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::NatGateway&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;AllocationId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;NAT1EIP&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;AllocationId&quot;</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet1&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;NATGateway2&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;DependsOn&quot;</span><span class="p">:</span> <span class="s2">&quot;VPCGatewayAttachment&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::NatGateway&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;AllocationId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;NAT2EIP&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;AllocationId&quot;</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet2&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;NATGateway3&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;DependsOn&quot;</span><span class="p">:</span> <span class="s2">&quot;VPCGatewayAttachment&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::NatGateway&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;AllocationId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;NAT3EIP&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;AllocationId&quot;</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet3&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;NATGateway4&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;DependsOn&quot;</span><span class="p">:</span> <span class="s2">&quot;VPCGatewayAttachment&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::NatGateway&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;AllocationId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;NAT4EIP&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;AllocationId&quot;</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet4&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;S3VPCEndpoint&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::EC2::VPCEndpoint&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;PolicyDocument&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;Principal&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nt">&quot;RouteTableIds&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1ARouteTable&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2ARouteTable&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3ARouteTable&quot;</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;PrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4ARouteTable&quot;</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1BRouteTable&quot;</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2BRouteTable&quot;</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;AdditionalPrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3BRouteTable&quot;</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;AdditionalPrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4BRouteTable&quot;</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;AWS::NoValue&quot;</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="nt">&quot;ServiceName&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;com.amazonaws.${AWS::Region}.s3&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;Outputs&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;NAT1EIP&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;NAT 1 IP address&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;NAT1EIP&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-NAT1EIP&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;NAT2EIP&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;NAT 2 IP address&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;NAT2EIP&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-NAT2EIP&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;NAT3EIP&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;NAT 3 IP address&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;NAT3EIP&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-NAT3EIP&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;NAT4EIP&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;NAT 4 IP address&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;NAT4EIP&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-NAT4EIP&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1ACIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 1A CIDR in Availability Zone 1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1ACIDR&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet1ACIDR&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1AID&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 1A ID in Availability Zone 1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1A&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet1AID&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1BCIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 1B CIDR in Availability Zone 1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1BCIDR&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet1BCIDR&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1BID&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 1B ID in Availability Zone 1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1B&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet1BID&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2ACIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 2A CIDR in Availability Zone 2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2ACIDR&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet2ACIDR&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2AID&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 2A ID in Availability Zone 2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2A&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet2AID&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2BCIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 2B CIDR in Availability Zone 2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2BCIDR&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet2BCIDR&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2BID&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 2B ID in Availability Zone 2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2B&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet2BID&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3ACIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 3A CIDR in Availability Zone 3&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3ACIDR&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet3ACIDR&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3AID&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 3A ID in Availability Zone 3&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3A&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet3AID&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3BCIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 3B CIDR in Availability Zone 3&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3BCIDR&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet3BCIDR&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3BID&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 3B ID in Availability Zone 3&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3B&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet3BID&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4ACIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 4A CIDR in Availability Zone 4&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4ACIDR&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet4ACIDR&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4AID&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 4A ID in Availability Zone 4&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4A&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet4AID&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4BCIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 4B CIDR in Availability Zone 4&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4BCIDR&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet4BCIDR&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4BID&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 4B ID in Availability Zone 4&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4B&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet4BID&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet1CIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet 1 CIDR in Availability Zone 1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet1CIDR&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PublicSubnet1CIDR&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet1ID&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet 1 ID in Availability Zone 1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet1&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PublicSubnet1ID&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet2CIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet 2 CIDR in Availability Zone 2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet2CIDR&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PublicSubnet2CIDR&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet2ID&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet 2 ID in Availability Zone 2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet2&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PublicSubnet2ID&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet3CIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet 3 CIDR in Availability Zone 3&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet3CIDR&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PublicSubnet3CIDR&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet3ID&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet 3 ID in Availability Zone 3&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet3&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PublicSubnet3ID&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet4CIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet 4 CIDR in Availability Zone 4&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet4CIDR&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PublicSubnet4CIDR&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnet4ID&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet 4 ID in Availability Zone 4&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnet4&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PublicSubnet4ID&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;S3VPCEndpoint&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;S3 VPC Endpoint&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;S3VPCEndpoint&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-S3VPCEndpoint&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1ARouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1ARouteTable&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 1A route table&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet1ARouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet1BRouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet1BRouteTable&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 1B route table&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet1BRouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2ARouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2ARouteTable&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 2A route table&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet2ARouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet2BRouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnetsCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet2BRouteTable&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 2B route table&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet2BRouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3ARouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3ARouteTable&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 3A route table&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet3ARouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet3BRouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;3AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet3BRouteTable&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 3B route table&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet3BRouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4ARouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4ARouteTable&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 4A route table&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet4ARouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PrivateSubnet4BRouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="s2">&quot;AdditionalPrivateSubnets&amp;4AZCondition&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivateSubnet4BRouteTable&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Private subnet 4B route table&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PrivateSubnet4BRouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;PublicSubnetRouteTable&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;PublicSubnetRouteTable&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Public subnet route table&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-PublicSubnetRouteTable&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;VPCCIDR&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPCCIDR&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC CIDR&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-VPCCIDR&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;VPCID&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Ref&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;VPC ID&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Export&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span> <span class="s2">&quot;${AWS::StackName}-VPCID&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h3 id="managedadstack">ManagedADStack<a class="headerlink" href="#managedadstack" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nt">AWSTemplateFormatVersion</span><span class="p">:</span> <span class="s">&#39;2010-09-09&#39;</span>
<span class="nt">Description</span><span class="p">:</span> <span class="p p-Indicator">&gt;-</span>
  <span class="no">This template creates a managed Microsoft AD Directory Service into private subnets</span>
  <span class="no">in separate Availability Zones inside a VPC. The default Domain Administrator user</span>
  <span class="no">is &#39;admin&#39;. For adding members to the domain, ensure that they are launched into</span>
  <span class="no">the domain member security group created by this template and then configure them</span>
  <span class="no">to use the AD instances fixed private IP addresses as the DNS server. **WARNING**</span>
  <span class="no">This template creates Amazon EC2 Windows instance and related resources. You will</span>
  <span class="no">be billed for the AWS resources used if you create a stack from this template. QS(0021)</span>
<span class="nt">Metadata</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">AWS::CloudFormation::Interface</span><span class="p p-Indicator">:</span>
    <span class="nt">ParameterGroups</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">Label</span><span class="p">:</span>
          <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Network Configuration</span>
        <span class="nt">Parameters</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">VPCCIDR</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">VPCID</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">PrivateSubnet1CIDR</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">PrivateSubnet1ID</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">PrivateSubnet2CIDR</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">PrivateSubnet2ID</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">PublicSubnet1CIDR</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">PublicSubnet2CIDR</span>
      <span class="p p-Indicator">-</span> <span class="nt">Label</span><span class="p">:</span>
          <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Microsoft Active Directory Configuration</span>
        <span class="nt">Parameters</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">DomainDNSName</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">DomainNetBIOSName</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">DomainAdminPassword</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ADEdition</span>
      <span class="p p-Indicator">-</span> <span class="nt">Label</span><span class="p">:</span>
          <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS Systems Manager AMI configuration</span>
        <span class="nt">Parameters</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">WS2019FULLBASE</span>
      <span class="p p-Indicator">-</span> <span class="nt">Label</span><span class="p">:</span>
          <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS Quick Start Configuration</span>
        <span class="nt">Parameters</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">QSS3BucketName</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">QSS3KeyPrefix</span>
    <span class="nt">ParameterLabels</span><span class="p">:</span>
      <span class="nt">DomainAdminPassword</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain Admin Password</span>
      <span class="nt">DomainDNSName</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain DNS Name</span>
      <span class="nt">DomainNetBIOSName</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain NetBIOS Name</span>
      <span class="nt">ADEdition</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS Microsoft AD edition</span>
      <span class="nt">PrivateSubnet1CIDR</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Private Subnet 1 CIDR</span>
      <span class="nt">PrivateSubnet1ID</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Private Subnet 1 ID</span>
      <span class="nt">PrivateSubnet2CIDR</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Private Subnet 2 CIDR</span>
      <span class="nt">PrivateSubnet2ID</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Private Subnet 2 ID</span>
      <span class="nt">PublicSubnet1CIDR</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Public Subnet 1 CIDR</span>
      <span class="nt">PublicSubnet2CIDR</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Public Subnet 2 CIDR</span>
      <span class="nt">QSS3BucketName</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Quick Start S3 Bucket Name</span>
      <span class="nt">QSS3KeyPrefix</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Quick Start S3 Key Prefix</span>
      <span class="nt">VPCCIDR</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">VPC CIDR</span>
      <span class="nt">VPCID</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">VPC ID</span>
      <span class="nt">WS2019FULLBASE</span><span class="p">:</span> 
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Windows Server 2019 full base AMI</span>
<span class="nt">Parameters</span><span class="p">:</span>
  <span class="nt">DomainAdminPassword</span><span class="p">:</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Password for the domain admin user. Must be at least 8 characters</span>
      <span class="l l-Scalar l-Scalar-Plain">containing letters, numbers and symbols</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
    <span class="nt">MinLength</span><span class="p">:</span> <span class="s">&#39;8&#39;</span>
    <span class="nt">MaxLength</span><span class="p">:</span> <span class="s">&#39;32&#39;</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(?=^.{6,255}$)((?=.*\d)(?=.*[A-Z])(?=.*[a-z])|(?=.*\d)(?=.*[^A-Za-z0-9])(?=.*[a-z])|(?=.*[^A-Za-z0-9])(?=.*[A-Z])(?=.*[a-z])|(?=.*\d)(?=.*[A-Z])(?=.*[^A-Za-z0-9]))^.*</span>
    <span class="nt">NoEcho</span><span class="p">:</span> <span class="s">&#39;true&#39;</span>
  <span class="nt">DomainDNSName</span><span class="p">:</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Fully qualified domain name (FQDN) of the forest root domain e.g.</span>
      <span class="l l-Scalar l-Scalar-Plain">example.com</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">example.com</span>
    <span class="nt">MinLength</span><span class="p">:</span> <span class="s">&#39;2&#39;</span>
    <span class="nt">MaxLength</span><span class="p">:</span> <span class="s">&#39;255&#39;</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="s">&#39;[a-zA-Z0-9\-]+\..+&#39;</span>
  <span class="nt">DomainNetBIOSName</span><span class="p">:</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">NetBIOS name of the domain (upto 15 characters) for users of earlier</span>
      <span class="l l-Scalar l-Scalar-Plain">versions of Windows e.g. EXAMPLE</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">example</span>
    <span class="nt">MinLength</span><span class="p">:</span> <span class="s">&#39;1&#39;</span>
    <span class="nt">MaxLength</span><span class="p">:</span> <span class="s">&#39;15&#39;</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="s">&#39;[a-zA-Z0-9\-]+&#39;</span>
  <span class="nt">ADEdition</span><span class="p">:</span>
    <span class="nt">AllowedValues</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Standard</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Enterprise</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Enterprise</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The AWS Microsoft AD edition. Valid values include Standard and Enterprise.</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">PrivateSubnet1CIDR</span><span class="p">:</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\/(1[6-9]|2[0-8]))$</span>
    <span class="nt">ConstraintDescription</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CIDR block parameter must be in the form x.x.x.x/16-28</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.0.0.0/19</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CIDR block for private subnet 1 located in Availability Zone 1.</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">PrivateSubnet1ID</span><span class="p">:</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ID of the private subnet 1 in Availability Zone 1 (e.g., subnet-a0246dcd)</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet::Id</span>
  <span class="nt">PrivateSubnet2CIDR</span><span class="p">:</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\/(1[6-9]|2[0-8]))$</span>
    <span class="nt">ConstraintDescription</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CIDR block parameter must be in the form x.x.x.x/16-28</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.0.32.0/19</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CIDR block for private subnet 2 located in Availability Zone 2.</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">PrivateSubnet2ID</span><span class="p">:</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ID of the private subnet 2 in Availability Zone 2 (e.g., subnet-a0246dcd)</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet::Id</span>
  <span class="nt">PublicSubnet1CIDR</span><span class="p">:</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\/(1[6-9]|2[0-8]))$</span>
    <span class="nt">ConstraintDescription</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CIDR block parameter must be in the form x.x.x.x/16-28</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.0.128.0/20</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CIDR Block for the public DMZ subnet 1 located in Availability Zone</span>
      <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">PublicSubnet2CIDR</span><span class="p">:</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\/(1[6-9]|2[0-8]))$</span>
    <span class="nt">ConstraintDescription</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CIDR block parameter must be in the form x.x.x.x/16-28</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.0.144.0/20</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CIDR Block for the public DMZ subnet 2 located in Availability Zone</span>
      <span class="l l-Scalar l-Scalar-Plain">2</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">QSS3BucketName</span><span class="p">:</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$</span>
    <span class="nt">ConstraintDescription</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Quick Start bucket name can include numbers, lowercase</span>
      <span class="l l-Scalar l-Scalar-Plain">letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen</span>
      <span class="l l-Scalar l-Scalar-Plain">(-).</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-quickstart</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">S3 bucket name for the Quick Start assets. Quick Start bucket name</span>
      <span class="l l-Scalar l-Scalar-Plain">can include numbers, lowercase letters, uppercase letters, and hyphens (-).</span>
      <span class="l l-Scalar l-Scalar-Plain">It cannot start or end with a hyphen (-).</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">QSS3KeyPrefix</span><span class="p">:</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">^[0-9a-zA-Z-/]*$</span>
    <span class="nt">ConstraintDescription</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Quick Start key prefix can include numbers, lowercase letters,</span>
      <span class="l l-Scalar l-Scalar-Plain">uppercase letters, hyphens (-), and forward slash (/).</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">quickstart-microsoft-activedirectory/</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">S3 key prefix for the Quick Start assets. Quick Start key prefix</span>
      <span class="l l-Scalar l-Scalar-Plain">can include numbers, lowercase letters, uppercase letters, hyphens (-), and</span>
      <span class="l l-Scalar l-Scalar-Plain">forward slash (/).</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">VPCCIDR</span><span class="p">:</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\/(1[6-9]|2[0-8]))$</span>
    <span class="nt">ConstraintDescription</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CIDR block parameter must be in the form x.x.x.x/16-28</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.0.0.0/16</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CIDR Block for the VPC</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">VPCID</span><span class="p">:</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ID of the VPC (e.g., vpc-0343606e)</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::EC2::VPC::Id</span>
  <span class="nt">WS2019FULLBASE</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="s">&#39;AWS::SSM::Parameter::Value&lt;AWS::EC2::Image::Id&gt;&#39;</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="s">&#39;/aws/service/ami-windows-latest/Windows_Server-2019-English-Full-Base&#39;</span>
<span class="nt">Rules</span><span class="p">:</span>
  <span class="nt">SubnetsInVPC</span><span class="p">:</span>
    <span class="nt">Assertions</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">Assert</span><span class="p">:</span> <span class="kt">!EachMemberIn</span>
          <span class="p p-Indicator">-</span> <span class="kt">!ValueOfAll</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet::Id</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">VpcId</span>
          <span class="p p-Indicator">-</span> <span class="kt">!RefAll</span> <span class="s">&#39;AWS::EC2::VPC::Id&#39;</span>
        <span class="nt">AssertDescription</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">All subnets must in the VPC</span>
<span class="nt">Conditions</span><span class="p">:</span>
  <span class="nt">GovCloudCondition</span><span class="p">:</span> <span class="kt">!Equals</span>
    <span class="p p-Indicator">-</span> <span class="kt">!Ref</span> <span class="s">&#39;AWS::Region&#39;</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">us-gov-west-1</span>
<span class="nt">Resources</span><span class="p">:</span>
  <span class="nt">DHCPOptions</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::EC2::DHCPOptions</span>
    <span class="nt">DependsOn</span><span class="p">:</span> 
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MicrosoftAD</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">SSMWaitCondition</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">DomainName</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;DomainDNSName&#39;</span>
      <span class="nt">DomainNameServers</span><span class="p">:</span> <span class="kt">!GetAtt</span> <span class="s">&#39;MicrosoftAD.DnsIpAddresses&#39;</span>
      <span class="nt">Tags</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">Key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain</span>
          <span class="nt">Value</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;DomainDNSName&#39;</span>
  <span class="nt">ADAdminSecrets</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::SecretsManager::Secret</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Name</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;ADAdminSecret-${AWS::StackName}&#39;</span>
      <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Admin User Seccrets for Manged AD Quick Start</span>
      <span class="nt">SecretString</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;{&quot;username&quot;:&quot;Admin&quot;,&quot;password&quot;:&quot;${DomainAdminPassword}&quot;}&#39;</span>
  <span class="nt">MicrosoftAD</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::DirectoryService::MicrosoftAD</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Name</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;DomainDNSName&#39;</span>
      <span class="nt">Edition</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;ADEdition&#39;</span>
      <span class="nt">ShortName</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;DomainNetBIOSName&#39;</span>
      <span class="nt">Password</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;DomainAdminPassword&#39;</span>
      <span class="nt">VpcSettings</span><span class="p">:</span>
        <span class="nt">SubnetIds</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="kt">!Ref</span> <span class="s">&#39;PrivateSubnet1ID&#39;</span>
          <span class="p p-Indicator">-</span> <span class="kt">!Ref</span> <span class="s">&#39;PrivateSubnet2ID&#39;</span>
        <span class="nt">VpcId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;VPCID&#39;</span>
  <span class="nt">DomainMemberSG</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SecurityGroup</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">GroupDescription</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain Members</span>
      <span class="nt">VpcId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;VPCID&#39;</span>
      <span class="nt">SecurityGroupIngress</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5985</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5985</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;PrivateSubnet1CIDR&#39;</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">53</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">53</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;PrivateSubnet1CIDR&#39;</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">53</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">53</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;PrivateSubnet1CIDR&#39;</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">49152</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">65535</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;PrivateSubnet1CIDR&#39;</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">49152</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">65535</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;PrivateSubnet1CIDR&#39;</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5985</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5985</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;PrivateSubnet2CIDR&#39;</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">53</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">53</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;PrivateSubnet2CIDR&#39;</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">53</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">53</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;PrivateSubnet2CIDR&#39;</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">49152</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">65535</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;PrivateSubnet2CIDR&#39;</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">49152</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">65535</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;PrivateSubnet2CIDR&#39;</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3389</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3389</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;PublicSubnet1CIDR&#39;</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3389</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3389</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;PublicSubnet2CIDR&#39;</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">636</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">636</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">VPCCIDR</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3269</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3269</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">VPCCIDR</span>
  <span class="nt">SSMAutomationRole</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::IAM::Role</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Policies</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">PolicyDocument</span><span class="p">:</span>
            <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
            <span class="nt">Statement</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">Action</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">s3:GetObject</span>
                <span class="nt">Resource</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:${AWS::Partition}:s3:::${QSS3BucketName}/${QSS3KeyPrefix}*&#39;</span>
                <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
          <span class="nt">PolicyName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-quick-start-s3-policy</span>
        <span class="p p-Indicator">-</span> <span class="nt">PolicyDocument</span><span class="p">:</span>
            <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
            <span class="nt">Statement</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
                <span class="nt">Action</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">cloudformation:SignalResource</span>
                <span class="nt">Resource</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:${AWS::Partition}:cloudformation:${AWS::Region}:${AWS::AccountId}:stack/${AWS::StackName}/*&#39;</span>
          <span class="nt">PolicyName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-quick-start-cfn-signal-policy</span>
        <span class="p p-Indicator">-</span> <span class="nt">PolicyDocument</span><span class="p">:</span>
            <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
            <span class="nt">Statement</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
                <span class="nt">Action</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">iam:CreateRole</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">iam:PutRolePolicy</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">iam:getRolePolicy</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">iam:DetachRolePolicy</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">iam:AttachRolePolicy</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">iam:DeleteRolePolicy</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">iam:CreateInstanceProfile</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">iam:DeleteRole</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">iam:RemoveRoleFromInstanceProfile</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">iam:AddRoleToInstanceProfile</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">iam:DeleteInstanceProfile</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">iam:PassRole</span>
                <span class="nt">Resource</span><span class="p">:</span> <span class="s">&#39;*&#39;</span>
          <span class="nt">PolicyName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-quick-start-create-role-policy</span>
        <span class="p p-Indicator">-</span> <span class="nt">PolicyDocument</span><span class="p">:</span>
            <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
            <span class="nt">Statement</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
                <span class="nt">Action</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">secretsmanager:GetSecretValue</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">secretsmanager:DescribeSecret</span>
                <span class="nt">Resource</span><span class="p">:</span> 
                  <span class="p p-Indicator">-</span> <span class="kt">!Ref</span> <span class="s">&#39;ADAdminSecrets&#39;</span>
              <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
                <span class="nt">Action</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ssm:StartAutomationExecution</span>
                <span class="nt">Resource</span><span class="p">:</span> <span class="s">&#39;*&#39;</span>
          <span class="nt">PolicyName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AD-SSM-Secrets</span>
      <span class="nt">Path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
      <span class="nt">AssumeRolePolicyDocument</span><span class="p">:</span>
        <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
        <span class="nt">Statement</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
            <span class="nt">Principal</span><span class="p">:</span>
              <span class="nt">Service</span><span class="p">:</span> 
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ssm.amazonaws.com</span>
            <span class="nt">Action</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sts:AssumeRole</span>
      <span class="nt">ManagedPolicyArns</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:${AWS::Partition}:iam::aws:policy/AmazonSSMFullAccess&#39;</span>
        <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:${AWS::Partition}:iam::aws:policy/AWSCloudFormationFullAccess&#39;</span>
        <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:${AWS::Partition}:iam::aws:policy/AmazonEC2FullAccess&#39;</span>
  <span class="nt">LambdaSSMRole</span><span class="p">:</span>
    <span class="nt">DependsOn</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MicrosoftAD</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::IAM::Role</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Policies</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">PolicyDocument</span><span class="p">:</span>
           <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
           <span class="nt">Statement</span><span class="p">:</span>
             <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
               <span class="nt">Action</span><span class="p">:</span>
                 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">iam:PassRole</span>
               <span class="nt">Resource</span><span class="p">:</span> <span class="kt">!GetAtt</span> <span class="l l-Scalar l-Scalar-Plain">SSMAutomationRole.Arn</span>
          <span class="nt">PolicyName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">QS-SSM-PassRole</span>
      <span class="nt">Path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
      <span class="nt">AssumeRolePolicyDocument</span><span class="p">:</span>
        <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
        <span class="nt">Statement</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
            <span class="nt">Principal</span><span class="p">:</span>
              <span class="nt">Service</span><span class="p">:</span> 
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lambda.amazonaws.com</span>
            <span class="nt">Action</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sts:AssumeRole</span>
      <span class="nt">ManagedPolicyArns</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:${AWS::Partition}:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole&#39;</span>
        <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:${AWS::Partition}:iam::aws:policy/service-role/AmazonSSMAutomationRole&#39;</span>
  <span class="nt">DNSForwarderSetup</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::SSM::Document</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">DocumentType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Automation</span>
      <span class="nt">Content</span><span class="p">:</span>
        <span class="nt">schemaVersion</span><span class="p">:</span> <span class="s">&quot;0.3&quot;</span>
        <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Setup DNS Forwarder for AWS Managed AD to VPC DNS</span>
        <span class="nt">assumeRole</span><span class="p">:</span> <span class="s">&quot;{{AutomationAssumeRole}}&quot;</span>
        <span class="nt">parameters</span><span class="p">:</span>
          <span class="nt">StackName</span><span class="p">:</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;Stack</span><span class="nv"> </span><span class="s">Name</span><span class="nv"> </span><span class="s">Input</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">cfn</span><span class="nv"> </span><span class="s">resource</span><span class="nv"> </span><span class="s">signal&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">DomainMemberSG</span><span class="p">:</span>
            <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Security group ID that can communicate with domain controllers</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">VPCCIDR</span><span class="p">:</span>
            <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">VPC CIDR</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">QSS3BucketName</span><span class="p">:</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;S3</span><span class="nv"> </span><span class="s">bucket</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Quick</span><span class="nv"> </span><span class="s">Start</span><span class="nv"> </span><span class="s">assets.</span><span class="nv"> </span><span class="s">Quick</span><span class="nv"> </span><span class="s">Start</span><span class="nv"> </span><span class="s">bucket</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">can</span><span class="nv"> </span><span class="s">include</span><span class="nv"> </span><span class="s">numbers,</span><span class="nv"> </span><span class="s">lowercase</span><span class="nv"> </span><span class="s">letters,</span><span class="nv"> </span><span class="s">uppercase</span><span class="nv"> </span><span class="s">letters,</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">hyphens</span><span class="nv"> </span><span class="s">(-).</span><span class="nv"> </span><span class="s">It</span><span class="nv"> </span><span class="s">cannot</span><span class="nv"> </span><span class="s">start</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">end</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">hyphen</span><span class="nv"> </span><span class="s">(-).&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">QSS3KeyPrefix</span><span class="p">:</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;S3</span><span class="nv"> </span><span class="s">key</span><span class="nv"> </span><span class="s">prefix</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Quick</span><span class="nv"> </span><span class="s">Start</span><span class="nv"> </span><span class="s">assets.</span><span class="nv"> </span><span class="s">Quick</span><span class="nv"> </span><span class="s">Start</span><span class="nv"> </span><span class="s">key</span><span class="nv"> </span><span class="s">prefix</span><span class="nv"> </span><span class="s">can</span><span class="nv"> </span><span class="s">include</span><span class="nv"> </span><span class="s">numbers,</span><span class="nv"> </span><span class="s">lowercase</span><span class="nv"> </span><span class="s">letters,</span><span class="nv"> </span><span class="s">uppercase</span><span class="nv"> </span><span class="s">letters,</span><span class="nv"> </span><span class="s">hyphens</span><span class="nv"> </span><span class="s">(-),</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">forward</span><span class="nv"> </span><span class="s">slash</span><span class="nv"> </span><span class="s">(/).&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">PrivateSubnet1ID</span><span class="p">:</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;Private</span><span class="nv"> </span><span class="s">Subnet</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">ID&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">AutomationAssumeRole</span><span class="p">:</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;(Optional)</span><span class="nv"> </span><span class="s">The</span><span class="nv"> </span><span class="s">ARN</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">role</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">allows</span><span class="nv"> </span><span class="s">Automation</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">perform</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">actions</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">your</span><span class="nv"> </span><span class="s">behalf.&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">DirectoryID</span><span class="p">:</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;Alias</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">directory</span><span class="nv"> </span><span class="s">ID&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">AWSRegion</span><span class="p">:</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;Region&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">URLSuffix</span><span class="p">:</span>
            <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;amazonaws.com&quot;</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;AWS</span><span class="nv"> </span><span class="s">URL</span><span class="nv"> </span><span class="s">suffix&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
        <span class="nt">mainSteps</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">CreateStack</span>
          <span class="nt">action</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws:createStack</span>
          <span class="nt">onFailure</span><span class="p">:</span> <span class="s">&quot;step:CFNSignalEnd&quot;</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">StackName</span><span class="p">:</span> <span class="s">&quot;SetDNSForwarder&quot;</span>
            <span class="nt">Capabilities</span><span class="p">:</span> <span class="p p-Indicator">[</span> <span class="s">&quot;CAPABILITY_IAM&quot;</span> <span class="p p-Indicator">]</span>
            <span class="nt">TemplateBody</span><span class="p">:</span> <span class="p p-Indicator">|</span>
              <span class="no">Description: &quot;Deploy Instance to create DNS forwarder on AWS Managed AD&quot;</span>
              <span class="no">Parameters:</span>
                <span class="no">WINFULLBASE:</span>
                  <span class="no">Type: &#39;AWS::SSM::Parameter::Value&lt;AWS::EC2::Image::Id&gt;&#39;</span>
                  <span class="no">Default: &#39;/aws/service/ami-windows-latest/Windows_Server-2019-English-Full-Base&#39;</span>
                <span class="no">QSS3BucketName:</span>
                  <span class="no">Type: &quot;String&quot;</span>
                  <span class="no">Default: &quot;{{QSS3BucketName}}&quot;</span>
                  <span class="no">Description: &quot;Name of Target S3 Bucket&quot;</span>
                <span class="no">QSS3KeyPrefix:</span>
                  <span class="no">Type: &quot;String&quot;</span>
                  <span class="no">Default: &quot;{{QSS3KeyPrefix}}&quot;</span>
                  <span class="no">Description: &quot;Name of Target S3 Prefix&quot;</span>
                <span class="no">SecurityGroup:</span>
                  <span class="no">Description: Security Group to be able to talk Domain Controllers</span>
                  <span class="no">Default: &quot;{{DomainMemberSG}}&quot;</span>
                  <span class="no">Type: &quot;String&quot;</span>
                <span class="no">Subnet:</span>
                  <span class="no">Description: &quot;Subnet to deploy the EC2 instnace&quot;</span>
                  <span class="no">Default: &quot;{{PrivateSubnet1ID}}&quot;</span>
                  <span class="no">Type: &quot;String&quot;</span>
              <span class="no">Resources:</span>
                <span class="no">ForwarderRole: </span>
                  <span class="no">Type : AWS::IAM::Role</span>
                  <span class="no">Properties:</span>
                    <span class="no">Policies:</span>
                      <span class="no">- PolicyDocument:</span>
                          <span class="no">Version: &#39;2012-10-17&#39;</span>
                          <span class="no">Statement:</span>
                            <span class="no">- Action:</span>
                                <span class="no">- s3:GetObject</span>
                                <span class="no">- s3:ListBucket</span>
                              <span class="no">Resource:</span>
                                <span class="no">- !Sub &#39;arn:${AWS::Partition}:s3:::${QSS3BucketName}/${QSS3KeyPrefix}*&#39;</span>
                                <span class="no">- !Sub &#39;arn:${AWS::Partition}:s3:::${QSS3BucketName}&#39;</span>
                              <span class="no">Effect: Allow</span>
                        <span class="no">PolicyName: s3-instance-bucket-policy</span>
                    <span class="no">Path: /</span>
                    <span class="no">ManagedPolicyArns:</span>
                    <span class="no">- !Sub &#39;arn:${AWS::Partition}:iam::aws:policy/AmazonSSMManagedInstanceCore&#39;</span>
                    <span class="no">- !Sub &#39;arn:${AWS::Partition}:iam::aws:policy/CloudWatchAgentServerPolicy&#39;</span>
                    <span class="no">- !Sub &#39;arn:${AWS::Partition}:iam::aws:policy/AWSDirectoryServiceFullAccess&#39;</span>
                    <span class="no">AssumeRolePolicyDocument:</span>
                      <span class="no">Version: &quot;2012-10-17&quot;</span>
                      <span class="no">Statement:</span>
                      <span class="no">- Effect: &quot;Allow&quot;</span>
                        <span class="no">Principal:</span>
                          <span class="no">Service:</span>
                          <span class="no">- &quot;ec2.amazonaws.com&quot;</span>
                          <span class="no">- &quot;ssm.amazonaws.com&quot;</span>
                        <span class="no">Action: &quot;sts:AssumeRole&quot;</span>
                <span class="no">IamInstanceProfile:</span>
                  <span class="no">Type: &quot;AWS::IAM::InstanceProfile&quot;</span>
                  <span class="no">Properties:</span>
                    <span class="no">Roles:</span>
                    <span class="no">- !Ref ForwarderRole</span>
                <span class="no">EC2Instance:</span>
                  <span class="no">Type: &quot;AWS::EC2::Instance&quot;</span>
                  <span class="no">Properties:</span>
                    <span class="no">ImageId: !Ref WINFULLBASE</span>
                    <span class="no">InstanceType: &quot;t3.medium&quot;</span>
                    <span class="no">IamInstanceProfile: !Ref IamInstanceProfile</span>
                    <span class="no">SecurityGroupIds:</span>
                      <span class="no">- !Ref &#39;SecurityGroup&#39;</span>
                    <span class="no">SubnetId: !Ref Subnet</span>
                    <span class="no">Tags:</span>
                    <span class="no">- Key: &quot;Name&quot;</span>
                      <span class="no">Value: &quot;TempDNSForwarder&quot;</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;getInstanceId&quot;</span>
          <span class="nt">action</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws:executeAwsApi</span>
          <span class="nt">onFailure</span><span class="p">:</span> <span class="s">&quot;step:CFNSignalEnd&quot;</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">Service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
            <span class="nt">Api</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DescribeInstances</span>
            <span class="nt">Filters</span><span class="p">:</span>  
            <span class="p p-Indicator">-</span> <span class="nt">Name</span><span class="p">:</span> <span class="s">&quot;tag:Name&quot;</span>
              <span class="nt">Values</span><span class="p">:</span> <span class="p p-Indicator">[</span> <span class="s">&quot;TempDNSForwarder&quot;</span> <span class="p p-Indicator">]</span>
            <span class="p p-Indicator">-</span> <span class="nt">Name</span><span class="p">:</span> <span class="s">&quot;instance-state-name&quot;</span>
              <span class="nt">Values</span><span class="p">:</span> <span class="p p-Indicator">[</span> <span class="s">&quot;running&quot;</span> <span class="p p-Indicator">]</span>
          <span class="nt">outputs</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">Name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">InstanceId</span>
            <span class="nt">Selector</span><span class="p">:</span> <span class="s">&quot;$.Reservations[0].Instances[0].InstanceId&quot;</span>
            <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;CreateDNSForward&quot;</span>
          <span class="nt">action</span><span class="p">:</span> <span class="s">&quot;aws:runCommand&quot;</span>
          <span class="nt">onFailure</span><span class="p">:</span> <span class="s">&quot;step:signalfailure&quot;</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">DocumentName</span><span class="p">:</span> <span class="s">&quot;AWS-RunRemoteScript&quot;</span>
            <span class="nt">InstanceIds</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="s">&quot;{{getInstanceId.InstanceId}}&quot;</span>
            <span class="nt">CloudWatchOutputConfig</span><span class="p">:</span>
              <span class="nt">CloudWatchOutputEnabled</span><span class="p">:</span> <span class="s">&quot;true&quot;</span>
              <span class="nt">CloudWatchLogGroupName</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;/aws/Quick_Start/${AWS::StackName}&#39;</span>
            <span class="nt">Parameters</span><span class="p">:</span>
              <span class="nt">sourceType</span><span class="p">:</span> <span class="s">&quot;S3&quot;</span>
              <span class="nt">sourceInfo</span><span class="p">:</span> 
                <span class="kt">!Sub</span> <span class="s">&#39;{&quot;path&quot;:</span><span class="nv"> </span><span class="s">&quot;https://${QSS3BucketName}.s3.{{URLSuffix}}/{{QSS3KeyPrefix}}scripts/AddDNSForward.ps1&quot;}&#39;</span>
              <span class="nt">commandLine</span><span class="p">:</span> <span class="s">&quot;./AddDNSForward.ps1</span><span class="nv"> </span><span class="s">-DirectoryID</span><span class="nv"> </span><span class="s">{{DirectoryID}}</span><span class="nv"> </span><span class="s">-VPCCIDR</span><span class="nv"> </span><span class="s">{{VPCCIDR}}</span><span class="nv"> </span><span class="s">-AWSRegion</span><span class="nv"> </span><span class="s">{{AWSRegion}}&quot;</span>
        <span class="c1"># Determines if CFN Needs to be Signaled or if Work flow should just end</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CFNSignalEnd</span>
          <span class="nt">action</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws:branch</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">Choices</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">NextStep</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">signalsuccess</span>
              <span class="nt">Not</span><span class="p">:</span> 
                <span class="nt">Variable</span><span class="p">:</span> <span class="s">&quot;{{StackName}}&quot;</span>
                <span class="nt">StringEquals</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
            <span class="p p-Indicator">-</span> <span class="nt">NextStep</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sleepend</span>
              <span class="nt">Variable</span><span class="p">:</span> <span class="s">&quot;{{StackName}}&quot;</span>
              <span class="nt">StringEquals</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
        <span class="c1"># If all steps complete successfully signals CFN of Success</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;signalsuccess&quot;</span>
          <span class="nt">action</span><span class="p">:</span> <span class="s">&quot;aws:executeAwsApi&quot;</span>
          <span class="nt">nextStep</span><span class="p">:</span> <span class="s">&quot;deleteStack&quot;</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">Service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cloudformation</span>
            <span class="nt">Api</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SignalResource</span>
            <span class="nt">LogicalResourceId</span><span class="p">:</span> <span class="s">&quot;SSMWaitCondition&quot;</span>
            <span class="nt">StackName</span><span class="p">:</span> <span class="s">&quot;{{StackName}}&quot;</span>
            <span class="nt">Status</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SUCCESS</span>
            <span class="nt">UniqueId</span><span class="p">:</span> <span class="s">&quot;{{getInstanceId.InstanceId}}&quot;</span>
        <span class="c1"># If CFN Signl Not Needed this sleep ends work flow</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;sleepend&quot;</span>
          <span class="nt">action</span><span class="p">:</span> <span class="s">&quot;aws:sleep&quot;</span>
          <span class="nt">nextStep</span><span class="p">:</span> <span class="s">&quot;deleteStack&quot;</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">Duration</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PT1S</span>
        <span class="c1"># If any steps fails signals CFN of Failure</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;signalfailure&quot;</span>
          <span class="nt">action</span><span class="p">:</span> <span class="s">&quot;aws:executeAwsApi&quot;</span>
          <span class="nt">nextStep</span><span class="p">:</span> <span class="s">&quot;deleteStack&quot;</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">Service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cloudformation</span>
            <span class="nt">Api</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SignalResource</span>
            <span class="nt">LogicalResourceId</span><span class="p">:</span> <span class="s">&quot;SSMWaitCondition&quot;</span>
            <span class="nt">StackName</span><span class="p">:</span> <span class="s">&quot;{{StackName}}&quot;</span>
            <span class="nt">Status</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FAILURE</span>
            <span class="nt">UniqueId</span><span class="p">:</span> <span class="s">&quot;{{getInstanceId.InstanceId}}&quot;</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">deleteStack</span>
          <span class="nt">action</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws:deleteStack</span>
          <span class="nt">isEnd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="c1">#          onFailure: Continue</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">StackName</span><span class="p">:</span> <span class="s">&quot;SetDNSForwarder&quot;</span>
  <span class="nt">LambdaSSMExecute</span><span class="p">:</span>
    <span class="nt">DependsOn</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LambdaSSMRole</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::Lambda::Function</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Executes SSM Automation Documents</span>
      <span class="nt">Handler</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">index.handler</span>
      <span class="nt">Runtime</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python3.7</span>
      <span class="nt">Role</span><span class="p">:</span> <span class="kt">!GetAtt</span> <span class="l l-Scalar l-Scalar-Plain">LambdaSSMRole.Arn</span>
      <span class="nt">Timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">900</span>
      <span class="nt">Code</span><span class="p">:</span>
        <span class="nt">ZipFile</span><span class="p">:</span> <span class="p p-Indicator">|</span>
          <span class="no">def handler(event, context):</span>
              <span class="no">import cfnresponse</span>
              <span class="no">import boto3, os, json</span>
              <span class="no">from botocore.vendored import requests</span>

              <span class="no">ssm_cl = boto3.client(&#39;ssm&#39;)</span>
              <span class="no">ecr_cl = boto3.client(&#39;ecr&#39;)</span>
              <span class="no">req_type = event[&#39;RequestType&#39;]</span>
              <span class="no">print(event)</span>

              <span class="no">SUCCESS = &quot;SUCCESS&quot;</span>
              <span class="no">FAILED = &quot;FAILED&quot;</span>

              <span class="no">def start_ssmautomation(event):</span>
                  <span class="no">doc_name = event[&#39;ResourceProperties&#39;][&#39;DocumentName&#39;]</span>
                  <span class="no">stack_name = event[&#39;ResourceProperties&#39;][&#39;StackName&#39;]</span>
                  <span class="no">ssm_role = event[&#39;ResourceProperties&#39;][&#39;AutomationAssumeRole&#39;]</span>
                  <span class="no">qs_bucket = event[&#39;ResourceProperties&#39;][&#39;QSS3BucketName&#39;]</span>
                  <span class="no">qs_bucket_prefix = event[&#39;ResourceProperties&#39;][&#39;QSS3KeyPrefix&#39;]</span>
                  <span class="no">security_group = event[&#39;ResourceProperties&#39;][&#39;DomainMemberSG&#39;]</span>
                  <span class="no">subnet_id = event[&#39;ResourceProperties&#39;][&#39;PrivateSubnet1ID&#39;]</span>
                  <span class="no">vpc_cidr = event[&#39;ResourceProperties&#39;][&#39;VPCCIDR&#39;]</span>
                  <span class="no">directory_id = event[&#39;ResourceProperties&#39;][&#39;DirectoryID&#39;]</span>
                  <span class="no">aws_region = event[&#39;ResourceProperties&#39;][&#39;AWSRegion&#39;]</span>
                  <span class="no">url_suffix = event[&#39;ResourceProperties&#39;][&#39;URLSuffix&#39;]</span>

                  <span class="no">start_automation = ssm_cl.start_automation_execution(</span>
                      <span class="no">DocumentName= doc_name,</span>
                      <span class="no">Parameters={</span>
                          <span class="no">&#39;StackName&#39;: [</span>
                              <span class="no">stack_name</span>
                          <span class="no">],</span>
                          <span class="no">&#39;AutomationAssumeRole&#39;: [</span>
                              <span class="no">ssm_role</span>
                          <span class="no">],</span>
                          <span class="no">&#39;QSS3BucketName&#39;: [</span>
                              <span class="no">qs_bucket</span>
                          <span class="no">],</span>
                          <span class="no">&#39;QSS3KeyPrefix&#39;: [</span>
                              <span class="no">qs_bucket_prefix</span>
                          <span class="no">],</span>
                          <span class="no">&#39;DomainMemberSG&#39;: [</span>
                              <span class="no">security_group</span>
                          <span class="no">],</span>
                          <span class="no">&#39;PrivateSubnet1ID&#39;: [</span>
                              <span class="no">subnet_id</span>
                          <span class="no">],</span>
                          <span class="no">&#39;VPCCIDR&#39;: [</span>
                              <span class="no">vpc_cidr</span>
                          <span class="no">],</span>
                          <span class="no">&#39;DirectoryID&#39;: [</span>
                              <span class="no">directory_id</span>
                          <span class="no">],</span>
                          <span class="no">&#39;AWSRegion&#39;: [</span>
                              <span class="no">aws_region</span>
                          <span class="no">],</span>
                          <span class="no">&#39;URLSuffix&#39;: [</span>
                              <span class="no">url_suffix</span>
                          <span class="no">]</span>
                      <span class="no">},</span>
                  <span class="no">)</span>

                  <span class="no">cfnresponse.send(event, context, SUCCESS, start_automation, start_automation[&#39;AutomationExecutionId&#39;])</span>

              <span class="no">def delete_image(event):</span>
                  <span class="no">cfnresponse.send(event, context, SUCCESS, event, &quot;Deleted&quot;)</span>

              <span class="no">actions = {</span>
                  <span class="no">&#39;Create&#39;: start_ssmautomation,</span>
                  <span class="no">&#39;Delete&#39;: delete_image,</span>
                  <span class="no">&#39;Update&#39;: start_ssmautomation</span>
              <span class="no">}</span>

              <span class="no">try:</span>
                  <span class="no">actions.get(req_type)(event)    </span>
              <span class="no">except Exception as exc:</span>
                  <span class="no">error_msg = {&#39;Error&#39;: &#39;{}&#39;.format(exc)}</span>
                  <span class="no">print(error_msg)</span>
                  <span class="no">cfnresponse.send(event, context, FAILED, error_msg)</span>
  <span class="nt">ExecuteSSMAutomation</span><span class="p">:</span>
    <span class="nt">DependsOn</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LambdaSSMExecute</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Custom::ExecuteSSMAutomation</span>
    <span class="nt">Properties</span><span class="p">:</span> 
      <span class="nt">ServiceToken</span><span class="p">:</span> <span class="kt">!GetAtt</span> <span class="l l-Scalar l-Scalar-Plain">LambdaSSMExecute.Arn</span>
      <span class="nt">DocumentName</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DNSForwarderSetup</span>
      <span class="nt">DomainMemberSG</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMemberSG</span>
      <span class="nt">StackName</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">AWS::StackName</span>
      <span class="nt">QSS3BucketName</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">QSS3BucketName</span>
      <span class="nt">QSS3KeyPrefix</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">QSS3KeyPrefix</span>
      <span class="nt">AutomationAssumeRole</span><span class="p">:</span> <span class="kt">!GetAtt</span> <span class="l l-Scalar l-Scalar-Plain">SSMAutomationRole.Arn</span>
      <span class="nt">PrivateSubnet1ID</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">PrivateSubnet1ID</span>
      <span class="nt">VPCCIDR</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">VPCCIDR</span>
      <span class="nt">DirectoryID</span><span class="p">:</span> <span class="kt">!GetAtt</span> <span class="s">&#39;MicrosoftAD.Alias&#39;</span>
      <span class="nt">AWSRegion</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;AWS::Region&#39;</span>
      <span class="nt">URLSuffix</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;AWS::URLSuffix&#39;</span>
  <span class="nt">SSMWaitHandle</span><span class="p">:</span> 
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::CloudFormation::WaitConditionHandle</span>
  <span class="nt">SSMWaitCondition</span><span class="p">:</span> 
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::CloudFormation::WaitCondition</span>
    <span class="nt">CreationPolicy</span><span class="p">:</span>
      <span class="nt">ResourceSignal</span><span class="p">:</span>
        <span class="nt">Timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PT60M</span>
        <span class="nt">Count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="nt">DependsOn</span><span class="p">:</span> 
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ExecuteSSMAutomation</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">SSMWaitHandle</span>
    <span class="nt">Properties</span><span class="p">:</span> 
      <span class="nt">Handle</span><span class="p">:</span> 
        <span class="nt">Ref</span><span class="p">:</span> <span class="s">&quot;SSMWaitHandle&quot;</span>
      <span class="nt">Timeout</span><span class="p">:</span> <span class="s">&quot;3600&quot;</span>
      <span class="nt">Count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">AWSQuickstartADRole</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::IAM::Role</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Policies</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">PolicyDocument</span><span class="p">:</span>
            <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
            <span class="nt">Statement</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">Action</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">s3:GetObject</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">s3:ListBucket</span>
                <span class="nt">Resource</span><span class="p">:</span> 
                  <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:${AWS::Partition}:s3:::${QSS3BucketName}/${QSS3KeyPrefix}*&#39;</span>
                  <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:${AWS::Partition}:s3:::${QSS3BucketName}&#39;</span>
                <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
          <span class="nt">PolicyName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-quick-start-s3-policy</span>
        <span class="p p-Indicator">-</span> <span class="nt">PolicyDocument</span><span class="p">:</span>
            <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
            <span class="nt">Statement</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
                <span class="nt">Action</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">cloudformation:SignalResource</span>
                <span class="nt">Resource</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:${AWS::Partition}:cloudformation:${AWS::Region}:${AWS::AccountId}:stack/${AWS::StackName}/*&#39;</span>
              <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
                <span class="nt">Action</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ec2:DescribeInstances</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ec2:DescribeInstanceStatus</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ssm:*</span>
                <span class="nt">Resource</span><span class="p">:</span> <span class="s">&#39;*&#39;</span>
          <span class="nt">PolicyName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AD-SSM-AutomationExecution</span>
      <span class="nt">Path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
      <span class="nt">AssumeRolePolicyDocument</span><span class="p">:</span>
        <span class="nt">Statement</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">Action</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">sts:AssumeRole</span>
            <span class="nt">Principal</span><span class="p">:</span>
              <span class="nt">Service</span><span class="p">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ec2.amazonaws.com</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ssm.amazonaws.com</span>
            <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
        <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>

<span class="nt">Outputs</span><span class="p">:</span>
  <span class="nt">ADServer1PrivateIP</span><span class="p">:</span>
    <span class="nt">Value</span><span class="p">:</span> <span class="kt">!Select</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;0&#39;</span>
      <span class="p p-Indicator">-</span> <span class="kt">!GetAtt</span> <span class="s">&#39;MicrosoftAD.DnsIpAddresses&#39;</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AD Server 1 Private IP Address (this may vary based on Directory</span>
      <span class="l l-Scalar l-Scalar-Plain">Service order of IP addresses)</span>
  <span class="nt">ADServer2PrivateIP</span><span class="p">:</span>
    <span class="nt">Value</span><span class="p">:</span> <span class="kt">!Select</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;1&#39;</span>
      <span class="p p-Indicator">-</span> <span class="kt">!GetAtt</span> <span class="s">&#39;MicrosoftAD.DnsIpAddresses&#39;</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AD Server 2 Private IP Address (this may vary based on Directory</span>
      <span class="l l-Scalar l-Scalar-Plain">Service order of IP addresses)</span>
  <span class="nt">DirectoryID</span><span class="p">:</span>
    <span class="nt">Value</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;MicrosoftAD&#39;</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Directory Services ID</span>
  <span class="nt">DomainAdmin</span><span class="p">:</span>
    <span class="nt">Value</span><span class="p">:</span> <span class="kt">!Join</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;&#39;</span>
      <span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="kt">!Ref</span> <span class="s">&#39;DomainNetBIOSName&#39;</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">\admin</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain administrator account</span>
  <span class="nt">DomainMemberSGID</span><span class="p">:</span>
    <span class="nt">Value</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;DomainMemberSG&#39;</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain Member Security Group ID</span>
  <span class="nt">ADSecretsArn</span><span class="p">:</span>
    <span class="nt">Value</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;ADAdminSecrets&#39;</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Managed AD Admin Secrets</span>
</pre></div>

<h3 id="adstack">ADStack<a class="headerlink" href="#adstack" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nt">AWSTemplateFormatVersion</span><span class="p">:</span> <span class="s">&#39;2010-09-09&#39;</span>
<span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">This template creates 1 Windows 2019 Active Directory Domain Controllers</span>
  <span class="l l-Scalar l-Scalar-Plain">into private subnets in separate Availability Zones inside a VPC. The default Domain</span>
  <span class="l l-Scalar l-Scalar-Plain">Administrator password will be the one retrieved from the instance.  For adding</span>
  <span class="l l-Scalar l-Scalar-Plain">members to the domain, ensure that they are launched into the domain member security</span>
  <span class="l l-Scalar l-Scalar-Plain">group created by this template and then configure them to use the AD instances fixed</span>
  <span class="l l-Scalar l-Scalar-Plain">private IP addresses as the DNS server. **WARNING** This template creates Amazon</span>
  <span class="l l-Scalar l-Scalar-Plain">EC2 Windows instance and related resources. You will be billed for the AWS resources</span>
  <span class="l l-Scalar l-Scalar-Plain">used if you create a stack from this template. QS(0001)</span>
<span class="nt">Metadata</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">AWS::CloudFormation::Interface</span><span class="p p-Indicator">:</span>
    <span class="nt">ParameterGroups</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">Label</span><span class="p">:</span>
          <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Network Configuration</span>
        <span class="nt">Parameters</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">VPCCIDR</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">VPCID</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">PrivateSubnet1ID</span>
      <span class="p p-Indicator">-</span> <span class="nt">Label</span><span class="p">:</span>
          <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Amazon EC2 Configuration</span>
        <span class="nt">Parameters</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ADServer1InstanceType</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ADServer1NetBIOSName</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ADServer1PrivateIP</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ADServer2InstanceType</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ADServer2NetBIOSName</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ADServer2PrivateIP</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">WS2016FULLBASE</span>
      <span class="p p-Indicator">-</span> <span class="nt">Label</span><span class="p">:</span>
          <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Microsoft Active Directory Configuration</span>
        <span class="nt">Parameters</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">DomainAdminPassword</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">DomainAdminUser</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">DomainDNSName</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">DomainNetBIOSName</span>
      <span class="p p-Indicator">-</span> <span class="nt">Label</span><span class="p">:</span>
          <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS Quick Start Configuration</span>
        <span class="nt">Parameters</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">QSS3BucketName</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">QSS3KeyPrefix</span>
    <span class="nt">ParameterLabels</span><span class="p">:</span>
      <span class="nt">ADServer1InstanceType</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain Controller 1 Instance Type</span>
      <span class="nt">ADServer1NetBIOSName</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain Controller 1 NetBIOS Name</span>
      <span class="nt">ADServer1PrivateIP</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain Controller 1 Private IP Address</span>
      <span class="nt">DomainAdminPassword</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain Admin Password</span>
      <span class="nt">DomainAdminUser</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain Admin User Name</span>
      <span class="nt">DomainDNSName</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain DNS Name</span>
      <span class="nt">DomainNetBIOSName</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain NetBIOS Name</span>
      <span class="nt">WS2016FULLBASE</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SSM Parameter Value to grab the lastest AMI ID</span>
      <span class="nt">PrivateSubnet1ID</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Private Subnet 1 ID</span>
      <span class="nt">QSS3BucketName</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Quick Start S3 Bucket Name</span>
      <span class="nt">QSS3KeyPrefix</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Quick Start S3 Key Prefix</span>
      <span class="nt">VPCCIDR</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">VPC CIDR</span>
      <span class="nt">VPCID</span><span class="p">:</span>
        <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">VPC ID</span>
<span class="nt">Parameters</span><span class="p">:</span>
  <span class="nt">ADServer1InstanceType</span><span class="p">:</span>
    <span class="nt">AllowedValues</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">t2.large</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">m4.large</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">m4.xlarge</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">m4.2xlarge</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">m4.4xlarge</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">m5.large</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">m5.xlarge</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">m5.2xlarge</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">m5.4xlarge</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">m5.xlarge</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Amazon EC2 instance type for the first Active Directory instance</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">ADServer1NetBIOSName</span><span class="p">:</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="s">&#39;[a-zA-Z0-9\-]+&#39;</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DC1</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">NetBIOS name of the first Active Directory server (up to 15 characters)</span>
    <span class="nt">MaxLength</span><span class="p">:</span> <span class="s">&#39;15&#39;</span>
    <span class="nt">MinLength</span><span class="p">:</span> <span class="s">&#39;1&#39;</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">ADServer1PrivateIP</span><span class="p">:</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.0.0.10</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Fixed private IP for the first Active Directory server located in</span>
      <span class="l l-Scalar l-Scalar-Plain">Availability Zone 1</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">DomainAdminPassword</span><span class="p">:</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(?=^.{6,255}$)((?=.*\d)(?=.*[A-Z])(?=.*[a-z])|(?=.*\d)(?=.*[^A-Za-z0-9])(?=.*[a-z])|(?=.*[^A-Za-z0-9])(?=.*[A-Z])(?=.*[a-z])|(?=.*\d)(?=.*[A-Z])(?=.*[^A-Za-z0-9]))^.*</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Password for the domain admin user. Must be at least 8 characters</span>
      <span class="l l-Scalar l-Scalar-Plain">containing letters, numbers and symbols</span>
    <span class="nt">MaxLength</span><span class="p">:</span> <span class="s">&#39;32&#39;</span>
    <span class="nt">MinLength</span><span class="p">:</span> <span class="s">&#39;8&#39;</span>
    <span class="nt">NoEcho</span><span class="p">:</span> <span class="s">&#39;true&#39;</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">DomainAdminUser</span><span class="p">:</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="s">&#39;[a-zA-Z0-9]*&#39;</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Admin</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">User name for the account that will be added as Domain Administrator.</span>
      <span class="l l-Scalar l-Scalar-Plain">This is separate from the default &quot;Administrator&quot; account</span>
    <span class="nt">MaxLength</span><span class="p">:</span> <span class="s">&#39;25&#39;</span>
    <span class="nt">MinLength</span><span class="p">:</span> <span class="s">&#39;5&#39;</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">DomainDNSName</span><span class="p">:</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="s">&#39;[a-zA-Z0-9\-]+\..+&#39;</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">example.com</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Fully qualified domain name (FQDN) of the forest root domain e.g.</span>
      <span class="l l-Scalar l-Scalar-Plain">example.com</span>
    <span class="nt">MaxLength</span><span class="p">:</span> <span class="s">&#39;255&#39;</span>
    <span class="nt">MinLength</span><span class="p">:</span> <span class="s">&#39;2&#39;</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">DomainNetBIOSName</span><span class="p">:</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="s">&#39;[a-zA-Z0-9\-]+&#39;</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">example</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">NetBIOS name of the domain (up to 15 characters) for users of earlier</span>
      <span class="l l-Scalar l-Scalar-Plain">versions of Windows e.g. EXAMPLE</span>
    <span class="nt">MaxLength</span><span class="p">:</span> <span class="s">&#39;15&#39;</span>
    <span class="nt">MinLength</span><span class="p">:</span> <span class="s">&#39;1&#39;</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">PrivateSubnet1ID</span><span class="p">:</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ID of the private subnet 1 in Availability Zone 1 (e.g., subnet-a0246dcd)</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet::Id</span>
  <span class="nt">QSS3BucketName</span><span class="p">:</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$</span>
    <span class="nt">ConstraintDescription</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Quick Start bucket name can include numbers, lowercase</span>
      <span class="l l-Scalar l-Scalar-Plain">letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen</span>
      <span class="l l-Scalar l-Scalar-Plain">(-).</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpublic</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">S3 bucket name for the Quick Start assets. Quick Start bucket name</span>
      <span class="l l-Scalar l-Scalar-Plain">can include numbers, lowercase letters, uppercase letters, and hyphens (-).</span>
      <span class="l l-Scalar l-Scalar-Plain">It cannot start or end with a hyphen (-).</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">QSS3KeyPrefix</span><span class="p">:</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">^[0-9a-zA-Z-/]*$</span>
    <span class="nt">ConstraintDescription</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Quick Start key prefix can include numbers, lowercase letters,</span>
      <span class="l l-Scalar l-Scalar-Plain">uppercase letters, hyphens (-), and forward slash (/).</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">quickstart-microsoft-activedirectory/</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">S3 key prefix for the Quick Start assets. Quick Start key prefix</span>
      <span class="l l-Scalar l-Scalar-Plain">can include numbers, lowercase letters, uppercase letters, hyphens (-), and</span>
      <span class="l l-Scalar l-Scalar-Plain">forward slash (/).</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">VPCCIDR</span><span class="p">:</span>
    <span class="nt">AllowedPattern</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\/(1[6-9]|2[0-8]))$</span>
    <span class="nt">ConstraintDescription</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CIDR block parameter must be in the form x.x.x.x/16-28</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.0.0.0/16</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CIDR Block for the VPC</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
  <span class="nt">VPCID</span><span class="p">:</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ID of the VPC (e.g., vpc-0343606e)</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::EC2::VPC::Id</span>
  <span class="nt">WS2016FULLBASE</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="s">&#39;AWS::SSM::Parameter::Value&lt;AWS::EC2::Image::Id&gt;&#39;</span>
    <span class="nt">Default</span><span class="p">:</span> <span class="s">&#39;/aws/service/ami-windows-latest/Windows_Server-2016-English-Full-Base&#39;</span>
<span class="nt">Rules</span><span class="p">:</span>
  <span class="nt">SubnetsInVPC</span><span class="p">:</span>
    <span class="nt">Assertions</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">Assert</span><span class="p">:</span> <span class="kt">!EachMemberIn</span>
          <span class="p p-Indicator">-</span> <span class="kt">!ValueOfAll</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet::Id</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">VpcId</span>
          <span class="p p-Indicator">-</span> <span class="kt">!RefAll</span> <span class="s">&#39;AWS::EC2::VPC::Id&#39;</span>
        <span class="nt">AssertDescription</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">All subnets must in the VPC</span>
<span class="nt">Conditions</span><span class="p">:</span>
  <span class="nt">GovCloudCondition</span><span class="p">:</span> <span class="kt">!Equals</span>
    <span class="p p-Indicator">-</span> <span class="kt">!Ref</span> <span class="s">&#39;AWS::Region&#39;</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">us-gov-west-1</span>
<span class="nt">Resources</span><span class="p">:</span>
  <span class="nt">DSCBucket</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::S3::Bucket</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">LifecycleConfiguration</span><span class="p">:</span>
        <span class="nt">Rules</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">Id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DeleteAfter30Days</span>
            <span class="nt">ExpirationInDays</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
            <span class="nt">Status</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Enabled</span>
            <span class="nt">Prefix</span><span class="p">:</span> <span class="s">&#39;logs/&#39;</span>
  <span class="nt">DHCPOptions</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::EC2::DHCPOptions</span>
    <span class="nt">DependsOn</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">DomainController1</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">DomainName</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;DomainDNSName&#39;</span>
      <span class="nt">DomainNameServers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="kt">!Ref</span> <span class="s">&#39;ADServer1PrivateIP&#39;</span>
      <span class="nt">Tags</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">Key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain</span>
          <span class="nt">Value</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;DomainDNSName&#39;</span>
  <span class="nt">VPCDHCPOptionsAssociation</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::EC2::VPCDHCPOptionsAssociation</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">VpcId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;VPCID&#39;</span>
      <span class="nt">DhcpOptionsId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;DHCPOptions&#39;</span>
  <span class="nt">AWSQuickstartActiveDirectoryDS</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::SSM::Document</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">DocumentType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Automation</span>
      <span class="nt">Content</span><span class="p">:</span>
        <span class="nt">schemaVersion</span><span class="p">:</span> <span class="s">&quot;0.3&quot;</span>
        <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;Deploy</span><span class="nv"> </span><span class="s">AD</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">SSM</span><span class="nv"> </span><span class="s">Automation&quot;</span>
        <span class="c1"># Role that is utilized to perform the steps within the Automation Document. In this case to be able to Signal CFN and Describe Instances. </span>
        <span class="nt">assumeRole</span><span class="p">:</span> <span class="s">&quot;{{AutomationAssumeRole}}&quot;</span>
        <span class="c1"># Gathering parameters needed to configure DCs in the Quick Start</span>
        <span class="nt">parameters</span><span class="p">:</span> 
          <span class="nt">ADServer1NetBIOSName</span><span class="p">:</span>
            <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;DC1&quot;</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;NetBIOS</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">first</span><span class="nv"> </span><span class="s">Active</span><span class="nv"> </span><span class="s">Directory</span><span class="nv"> </span><span class="s">server</span><span class="nv"> </span><span class="s">(up</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">15</span><span class="nv"> </span><span class="s">characters)&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">ADServer1PrivateIP</span><span class="p">:</span>
            <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;10.0.0.10&quot;</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;Fixed</span><span class="nv"> </span><span class="s">private</span><span class="nv"> </span><span class="s">IP</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">first</span><span class="nv"> </span><span class="s">Active</span><span class="nv"> </span><span class="s">Directory</span><span class="nv"> </span><span class="s">server</span><span class="nv"> </span><span class="s">located</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">Availability</span><span class="nv"> </span><span class="s">Zone</span><span class="nv"> </span><span class="s">1&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">VPCCIDR</span><span class="p">:</span>
            <span class="nt">default</span><span class="p">:</span> <span class="s">&#39;10.0.0.0/16&#39;</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;CIDR</span><span class="nv"> </span><span class="s">block</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">private</span><span class="nv"> </span><span class="s">subnet</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">located</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">Availability</span><span class="nv"> </span><span class="s">Zone</span><span class="nv"> </span><span class="s">1.&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">ADAdminSecParamName</span><span class="p">:</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;AWS</span><span class="nv"> </span><span class="s">Secrets</span><span class="nv"> </span><span class="s">Parameter</span><span class="nv"> </span><span class="s">Name</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">Password</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">User</span><span class="nv"> </span><span class="s">namer</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">domain</span><span class="nv"> </span><span class="s">administrator.&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">ADAltUserSecParamName</span><span class="p">:</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;AWS</span><span class="nv"> </span><span class="s">Secrets</span><span class="nv"> </span><span class="s">Parameter</span><span class="nv"> </span><span class="s">Name</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">account</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">added</span><span class="nv"> </span><span class="s">as</span><span class="nv"> </span><span class="s">Domain</span><span class="nv"> </span><span class="s">Administrator.</span><span class="nv"> </span><span class="s">This</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">separate</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">default</span><span class="nv"> </span><span class="s">Administrator</span><span class="nv"> </span><span class="s">account&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">RestoreModeSecParamName</span><span class="p">:</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;AWS</span><span class="nv"> </span><span class="s">Secrets</span><span class="nv"> </span><span class="s">Parameter</span><span class="nv"> </span><span class="s">Name</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Restore</span><span class="nv"> </span><span class="s">Mode</span><span class="nv"> </span><span class="s">Password&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">DomainDNSName</span><span class="p">:</span> 
            <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;example.com&quot;</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;Fully</span><span class="nv"> </span><span class="s">qualified</span><span class="nv"> </span><span class="s">domain</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">(FQDN)</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">forest</span><span class="nv"> </span><span class="s">root</span><span class="nv"> </span><span class="s">domain</span><span class="nv"> </span><span class="s">e.g.</span><span class="nv"> </span><span class="s">example.com&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">DomainNetBIOSName</span><span class="p">:</span> 
            <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;example&quot;</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;NetBIOS</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">domain</span><span class="nv"> </span><span class="s">(up</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">15</span><span class="nv"> </span><span class="s">characters)</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">users</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">earlier</span><span class="nv"> </span><span class="s">versions</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">Windows</span><span class="nv"> </span><span class="s">e.g.</span><span class="nv"> </span><span class="s">EXAMPLE&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">QSS3BucketName</span><span class="p">:</span>
            <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;aws-quickstart&quot;</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;S3</span><span class="nv"> </span><span class="s">bucket</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Quick</span><span class="nv"> </span><span class="s">Start</span><span class="nv"> </span><span class="s">assets.</span><span class="nv"> </span><span class="s">Quick</span><span class="nv"> </span><span class="s">Start</span><span class="nv"> </span><span class="s">bucket</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">can</span><span class="nv"> </span><span class="s">include</span><span class="nv"> </span><span class="s">numbers,</span><span class="nv"> </span><span class="s">lowercase</span><span class="nv"> </span><span class="s">letters,</span><span class="nv"> </span><span class="s">uppercase</span><span class="nv"> </span><span class="s">letters,</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">hyphens</span><span class="nv"> </span><span class="s">(-).</span><span class="nv"> </span><span class="s">It</span><span class="nv"> </span><span class="s">cannot</span><span class="nv"> </span><span class="s">start</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">end</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">hyphen</span><span class="nv"> </span><span class="s">(-).&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">QSS3KeyPrefix</span><span class="p">:</span>
            <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;quickstart-microsoft-activedirectory/&quot;</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;S3</span><span class="nv"> </span><span class="s">key</span><span class="nv"> </span><span class="s">prefix</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Quick</span><span class="nv"> </span><span class="s">Start</span><span class="nv"> </span><span class="s">assets.</span><span class="nv"> </span><span class="s">Quick</span><span class="nv"> </span><span class="s">Start</span><span class="nv"> </span><span class="s">key</span><span class="nv"> </span><span class="s">prefix</span><span class="nv"> </span><span class="s">can</span><span class="nv"> </span><span class="s">include</span><span class="nv"> </span><span class="s">numbers,</span><span class="nv"> </span><span class="s">lowercase</span><span class="nv"> </span><span class="s">letters,</span><span class="nv"> </span><span class="s">uppercase</span><span class="nv"> </span><span class="s">letters,</span><span class="nv"> </span><span class="s">hyphens</span><span class="nv"> </span><span class="s">(-),</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">forward</span><span class="nv"> </span><span class="s">slash</span><span class="nv"> </span><span class="s">(/).&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">URLSuffix</span><span class="p">:</span>
            <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;amazonaws.com&quot;</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;AWS</span><span class="nv"> </span><span class="s">URL</span><span class="nv"> </span><span class="s">suffix&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">StackName</span><span class="p">:</span>
            <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;Stack</span><span class="nv"> </span><span class="s">Name</span><span class="nv"> </span><span class="s">Input</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">cfn</span><span class="nv"> </span><span class="s">resource</span><span class="nv"> </span><span class="s">signal&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
          <span class="nt">AutomationAssumeRole</span><span class="p">:</span>
            <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
            <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;(Optional)</span><span class="nv"> </span><span class="s">The</span><span class="nv"> </span><span class="s">ARN</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">role</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">allows</span><span class="nv"> </span><span class="s">Automation</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">perform</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">actions</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">your</span><span class="nv"> </span><span class="s">behalf.&quot;</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
        <span class="nt">mainSteps</span><span class="p">:</span>
        <span class="c1"># This step grabs the Instance IDs for both nodes that will be configured as DCs in the Quick Start and Instance IDs for the for next steps.</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;dc1InstanceId&quot;</span>
          <span class="nt">action</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws:executeAwsApi</span>
          <span class="nt">onFailure</span><span class="p">:</span> <span class="s">&quot;step:signalfailure&quot;</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">Service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
            <span class="nt">Api</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DescribeInstances</span>
            <span class="nt">Filters</span><span class="p">:</span>  
            <span class="p p-Indicator">-</span> <span class="nt">Name</span><span class="p">:</span> <span class="s">&quot;tag:Name&quot;</span>
              <span class="nt">Values</span><span class="p">:</span> <span class="p p-Indicator">[</span> <span class="s">&quot;{{ADServer1NetBIOSName}}&quot;</span> <span class="p p-Indicator">]</span>
            <span class="p p-Indicator">-</span> <span class="nt">Name</span><span class="p">:</span> <span class="s">&quot;tag:aws:cloudformation:stack-name&quot;</span>
              <span class="nt">Values</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;{{StackName}}&quot;</span><span class="p p-Indicator">]</span>
            <span class="p p-Indicator">-</span> <span class="nt">Name</span><span class="p">:</span> <span class="s">&quot;instance-state-name&quot;</span>
              <span class="nt">Values</span><span class="p">:</span> <span class="p p-Indicator">[</span> <span class="s">&quot;running&quot;</span> <span class="p p-Indicator">]</span>
          <span class="nt">outputs</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">Name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">InstanceId</span>
            <span class="nt">Selector</span><span class="p">:</span> <span class="s">&quot;$.Reservations[0].Instances[0].InstanceId&quot;</span>
            <span class="nt">Type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
        <span class="c1"># Installs needed Powershell DSC Modules and components on both nodes.</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;dcInstallDscModules&quot;</span>
          <span class="nt">action</span><span class="p">:</span> <span class="s">&quot;aws:runCommand&quot;</span>
          <span class="nt">onFailure</span><span class="p">:</span> <span class="s">&quot;step:signalfailure&quot;</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">DocumentName</span><span class="p">:</span> <span class="s">&quot;AWS-RunRemoteScript&quot;</span>
            <span class="nt">InstanceIds</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="s">&quot;{{dc1InstanceId.InstanceId}}&quot;</span>
            <span class="nt">CloudWatchOutputConfig</span><span class="p">:</span>
              <span class="nt">CloudWatchOutputEnabled</span><span class="p">:</span> <span class="s">&quot;true&quot;</span>
              <span class="nt">CloudWatchLogGroupName</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;/aws/Quick_Start/${AWS::StackName}&#39;</span>
            <span class="nt">Parameters</span><span class="p">:</span>
              <span class="nt">sourceType</span><span class="p">:</span> <span class="s">&quot;S3&quot;</span>
              <span class="nt">sourceInfo</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;{&quot;path&quot;:</span><span class="nv"> </span><span class="s">&quot;https://${QSS3BucketName}.s3.amazonaws.com/{{QSS3KeyPrefix}}scripts/install-ad-modules.ps1&quot;}&#39;</span>
              <span class="nt">commandLine</span><span class="p">:</span> <span class="s">&quot;./install-ad-modules.ps1&quot;</span>
        <span class="c1"># Configures Local Configuration Manager on each of the nodes.</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;dcsLCMConfig&quot;</span>
          <span class="nt">action</span><span class="p">:</span> <span class="s">&quot;aws:runCommand&quot;</span>
          <span class="nt">onFailure</span><span class="p">:</span> <span class="s">&quot;step:signalfailure&quot;</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">DocumentName</span><span class="p">:</span> <span class="s">&quot;AWS-RunRemoteScript&quot;</span>
            <span class="nt">InstanceIds</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="s">&quot;{{dc1InstanceId.InstanceId}}&quot;</span>
            <span class="nt">CloudWatchOutputConfig</span><span class="p">:</span>
              <span class="nt">CloudWatchOutputEnabled</span><span class="p">:</span> <span class="s">&quot;true&quot;</span>
              <span class="nt">CloudWatchLogGroupName</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;/aws/Quick_Start/${AWS::StackName}&#39;</span>
            <span class="nt">Parameters</span><span class="p">:</span>
              <span class="nt">sourceType</span><span class="p">:</span> <span class="s">&quot;S3&quot;</span>
              <span class="nt">sourceInfo</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;{&quot;path&quot;:</span><span class="nv"> </span><span class="s">&quot;https://${QSS3BucketName}.s3.amazonaws.com/{{QSS3KeyPrefix}}scripts/LCM-Config.ps1&quot;}&#39;</span>
              <span class="nt">commandLine</span><span class="p">:</span> <span class="s">&quot;./LCM-Config.ps1&quot;</span>
        <span class="c1"># Generates MOF file on first DC Node to be processed by LCM.</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;createDC1Mof&quot;</span>
          <span class="nt">action</span><span class="p">:</span> <span class="s">&quot;aws:runCommand&quot;</span>
          <span class="nt">onFailure</span><span class="p">:</span> <span class="s">&quot;step:signalfailure&quot;</span>
          <span class="nt">nextStep</span><span class="p">:</span> <span class="s">&quot;configDC1&quot;</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">DocumentName</span><span class="p">:</span> <span class="s">&quot;AWS-RunRemoteScript&quot;</span>
            <span class="nt">InstanceIds</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="s">&quot;{{dc1InstanceId.InstanceId}}&quot;</span>
            <span class="nt">CloudWatchOutputConfig</span><span class="p">:</span>
              <span class="nt">CloudWatchOutputEnabled</span><span class="p">:</span> <span class="s">&quot;true&quot;</span>
              <span class="nt">CloudWatchLogGroupName</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;/aws/Quick_Start/${AWS::StackName}&#39;</span>
            <span class="nt">Parameters</span><span class="p">:</span>
              <span class="nt">sourceType</span><span class="p">:</span> <span class="s">&quot;S3&quot;</span>
              <span class="nt">sourceInfo</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;{&quot;path&quot;:</span><span class="nv"> </span><span class="s">&quot;https://${QSS3BucketName}.s3.amazonaws.com/{{QSS3KeyPrefix}}scripts/ConfigDC1.ps1&quot;}&#39;</span>
              <span class="nt">commandLine</span><span class="p">:</span> <span class="s">&quot;./ConfigDC1.ps1</span><span class="nv"> </span><span class="s">-ADServer1NetBIOSName</span><span class="nv"> </span><span class="s">{{ADServer1NetBIOSName}}</span><span class="nv"> </span><span class="s">-DomainNetBIOSName</span><span class="nv"> </span><span class="s">{{DomainNetBIOSName}}</span><span class="nv"> </span><span class="s">-DomainDNSName</span><span class="nv"> </span><span class="s">{{DomainDNSName}}</span><span class="nv"> </span><span class="s">-ADAdminSecParam</span><span class="nv"> </span><span class="s">{{ADAdminSecParamName}}</span><span class="nv"> </span><span class="s">-ADAltUserSecParam</span><span class="nv"> </span><span class="s">{{ADAltUserSecParamName}}</span><span class="nv"> </span><span class="s">-RestoreModeSecParam</span><span class="nv"> </span><span class="s">{{RestoreModeSecParamName}}</span><span class="nv"> </span><span class="s">-SiteName</span><span class="nv"> </span><span class="s">{{global:REGION}}</span><span class="nv"> </span><span class="s">-VPCCIDR</span><span class="nv"> </span><span class="s">{{VPCCIDR}}&quot;</span>
        <span class="c1"># Kicks off DSC Configuration and loops\reboots until Node matches Configuration defined in MOF file.</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;configDC1&quot;</span>
          <span class="nt">action</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws:runCommand</span>
          <span class="nt">onFailure</span><span class="p">:</span> <span class="s">&quot;step:signalfailure&quot;</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">DocumentName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS-RunPowerShellScript</span>
            <span class="nt">InstanceIds</span><span class="p">:</span> 
              <span class="p p-Indicator">-</span> <span class="s">&quot;{{dc1InstanceId.InstanceId}}&quot;</span>
            <span class="nt">CloudWatchOutputConfig</span><span class="p">:</span>
              <span class="nt">CloudWatchOutputEnabled</span><span class="p">:</span> <span class="s">&quot;true&quot;</span>
              <span class="nt">CloudWatchLogGroupName</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;/aws/Quick_Start/${AWS::StackName}&#39;</span>
            <span class="nt">Parameters</span><span class="p">:</span>
              <span class="nt">commands</span><span class="p">:</span> 
                <span class="p p-Indicator">-</span> <span class="p p-Indicator">|</span>     
                   <span class="no">function DscStatusCheck () {</span>
                       <span class="no">$LCMState = (Get-DscLocalConfigurationManager).LCMState</span>
                       <span class="no">if ($LCMState -eq &#39;PendingConfiguration&#39; -Or $LCMState -eq &#39;PendingReboot&#39;) {</span>
                           <span class="no">&#39;returning 3010, should continue after reboot&#39;</span>
                           <span class="no">exit 3010</span>
                       <span class="no">} else {</span>
                           <span class="no">&#39;Completed&#39;</span>
                       <span class="no">}</span>
                   <span class="no">}</span>

                   <span class="no">Start-DscConfiguration &#39;C:\AWSQuickstart\ConfigDC1&#39; -Wait -Verbose -Force</span>

                   <span class="no">DscStatusCheck</span>
        <span class="c1"># Ensure that AD servers point to themselves for DNS</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;DnsConfig&quot;</span>
          <span class="nt">action</span><span class="p">:</span> <span class="s">&quot;aws:runCommand&quot;</span>
          <span class="nt">onFailure</span><span class="p">:</span> <span class="s">&quot;step:signalfailure&quot;</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">DocumentName</span><span class="p">:</span> <span class="s">&quot;AWS-RunRemoteScript&quot;</span>
            <span class="nt">InstanceIds</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="s">&quot;{{dc1InstanceId.InstanceId}}&quot;</span>
            <span class="nt">CloudWatchOutputConfig</span><span class="p">:</span>
              <span class="nt">CloudWatchOutputEnabled</span><span class="p">:</span> <span class="s">&quot;true&quot;</span>
              <span class="nt">CloudWatchLogGroupName</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;/aws/Quick_Start/${AWS::StackName}&#39;</span>
            <span class="nt">Parameters</span><span class="p">:</span>
              <span class="nt">sourceType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">S3</span>
              <span class="nt">sourceInfo</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;{&quot;path&quot;:</span><span class="nv"> </span><span class="s">&quot;https://${QSS3BucketName}.s3.amazonaws.com/{{QSS3KeyPrefix}}scripts/Dns-Config.ps1&quot;}&#39;</span>
              <span class="nt">commandLine</span><span class="p">:</span> <span class="s">&quot;./Dns-Config.ps1</span><span class="nv"> </span><span class="s">-ADServer1NetBIOSName</span><span class="nv"> </span><span class="s">{{ADServer1NetBIOSName}}</span><span class="nv"> </span><span class="s">-ADServer1PrivateIP</span><span class="nv"> </span><span class="s">{{ADServer1PrivateIP}}</span><span class="nv"> </span><span class="s">-DomainDNSName</span><span class="nv"> </span><span class="s">{{DomainDNSName}}</span><span class="nv"> </span><span class="s">-ADAdminSecParam</span><span class="nv"> </span><span class="s">{{ADAdminSecParamName}}&quot;</span>
        <span class="c1"># Determines if CFN Needs to be Signaled or if Work flow should just end</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CFNSignalEnd</span>
          <span class="nt">action</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws:branch</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">Choices</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">NextStep</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">signalsuccess</span>
              <span class="nt">Not</span><span class="p">:</span> 
                <span class="nt">Variable</span><span class="p">:</span> <span class="s">&quot;{{StackName}}&quot;</span>
                <span class="nt">StringEquals</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
            <span class="p p-Indicator">-</span> <span class="nt">NextStep</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sleepend</span>
              <span class="nt">Variable</span><span class="p">:</span> <span class="s">&quot;{{StackName}}&quot;</span>
              <span class="nt">StringEquals</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
        <span class="c1"># If all steps complete successfully signals CFN of Success</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;signalsuccess&quot;</span>
          <span class="nt">action</span><span class="p">:</span> <span class="s">&quot;aws:executeAwsApi&quot;</span>
          <span class="nt">isEnd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">Service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cloudformation</span>
            <span class="nt">Api</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SignalResource</span>
            <span class="nt">LogicalResourceId</span><span class="p">:</span> <span class="s">&quot;DomainController1&quot;</span>
            <span class="nt">StackName</span><span class="p">:</span> <span class="s">&quot;{{StackName}}&quot;</span>
            <span class="nt">Status</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SUCCESS</span>
            <span class="nt">UniqueId</span><span class="p">:</span> <span class="s">&quot;{{dc1InstanceId.InstanceId}}&quot;</span>
        <span class="c1"># If CFN Signl Not Needed this sleep ends work flow</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;sleepend&quot;</span>
          <span class="nt">action</span><span class="p">:</span> <span class="s">&quot;aws:sleep&quot;</span>
          <span class="nt">isEnd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">Duration</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PT1S</span>
        <span class="c1"># If any steps fails signals CFN of Failure</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;signalfailure&quot;</span>
          <span class="nt">action</span><span class="p">:</span> <span class="s">&quot;aws:executeAwsApi&quot;</span>
          <span class="nt">inputs</span><span class="p">:</span>
            <span class="nt">Service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cloudformation</span>
            <span class="nt">Api</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SignalResource</span>
            <span class="nt">LogicalResourceId</span><span class="p">:</span> <span class="s">&quot;DomainController2&quot;</span>
            <span class="nt">StackName</span><span class="p">:</span> <span class="s">&quot;{{StackName}}&quot;</span>
            <span class="nt">Status</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FAILURE</span>
            <span class="nt">UniqueId</span><span class="p">:</span> <span class="s">&quot;{{dc1InstanceId.InstanceId}}&quot;</span>
  <span class="nt">AWSQuickstartADDSRole</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::IAM::Role</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Policies</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">PolicyDocument</span><span class="p">:</span>
            <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
            <span class="nt">Statement</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">Action</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">s3:GetObject</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">s3:ListBucket</span>
                <span class="nt">Resource</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="l l-Scalar l-Scalar-Plain">arn:${AWS::Partition}:s3:::${QSS3BucketName}/${QSS3KeyPrefix}*</span>
                  <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="l l-Scalar l-Scalar-Plain">arn:${AWS::Partition}:s3:::${QSS3BucketName}</span>
                <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
          <span class="nt">PolicyName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-quick-start-s3-policy</span>
        <span class="p p-Indicator">-</span> <span class="nt">PolicyDocument</span><span class="p">:</span>
            <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
            <span class="nt">Statement</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
                <span class="nt">Action</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">cloudformation:SignalResource</span>
                <span class="nt">Resource</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:aws:cloudformation:${AWS::Region}:${AWS::AccountId}:stack/${AWS::StackName}/*&#39;</span>
              <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
                <span class="nt">Action</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ec2:DescribeInstances</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ec2:DescribeInstanceStatus</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ssm:*</span>
                <span class="nt">Resource</span><span class="p">:</span> <span class="s">&#39;*&#39;</span>
          <span class="nt">PolicyName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AD-SSM-Automation</span>
      <span class="nt">Path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
      <span class="nt">AssumeRolePolicyDocument</span><span class="p">:</span>
        <span class="nt">Statement</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">Action</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">sts:AssumeRole</span>
            <span class="nt">Principal</span><span class="p">:</span>
              <span class="nt">Service</span><span class="p">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ec2.amazonaws.com</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ssm.amazonaws.com</span>
            <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
        <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
  <span class="nt">ADSsmPassRolePolicy</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::IAM::Policy</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">PolicyName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AD-SSM-PassRole</span>
      <span class="nt">PolicyDocument</span><span class="p">:</span>
        <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
        <span class="nt">Statement</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
            <span class="nt">Action</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">iam:PassRole</span>
            <span class="nt">Resource</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:aws:iam::${AWS::AccountId}:role/${AWSQuickstartADDSRole}&#39;</span>
      <span class="nt">Roles</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="kt">!Ref</span> <span class="s">&#39;AWSQuickstartADDSRole&#39;</span>
  <span class="nt">ADServerRole</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::IAM::Role</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Policies</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">PolicyDocument</span><span class="p">:</span>
            <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
            <span class="nt">Statement</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">Action</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">s3:GetObject</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">s3:ListBucket</span>
                <span class="nt">Resource</span><span class="p">:</span> 
                  <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="l l-Scalar l-Scalar-Plain">arn:${AWS::Partition}:s3:::${QSS3BucketName}/${QSS3KeyPrefix}*</span>
                  <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="l l-Scalar l-Scalar-Plain">arn:${AWS::Partition}:s3:::${QSS3BucketName}</span>
                <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
          <span class="nt">PolicyName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-quick-start-s3-policy</span>
        <span class="p p-Indicator">-</span> <span class="nt">PolicyDocument</span><span class="p">:</span>
            <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
            <span class="nt">Statement</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">Action</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">s3:GetObject</span>
                <span class="nt">Resource</span><span class="p">:</span> 
                  <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:aws:s3:::aws-ssm-${AWS::Region}/*&#39;</span>
                  <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:aws:s3:::aws-windows-downloads-${AWS::Region}/*&#39;</span>
                  <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:aws:s3:::amazon-ssm-${AWS::Region}/*&#39;</span>
                  <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:aws:s3:::amazon-ssm-packages-${AWS::Region}/*&#39;</span>
                  <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:aws:s3:::${AWS::Region}-birdwatcher-prod/*&#39;</span>
                  <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:aws:s3:::patch-baseline-snapshot-${AWS::Region}/*&#39;</span>
                <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
          <span class="nt">PolicyName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ssm-custom-s3-policy</span>
        <span class="p p-Indicator">-</span> <span class="nt">PolicyDocument</span><span class="p">:</span>
            <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
            <span class="nt">Statement</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
                <span class="nt">Action</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">secretsmanager:GetSecretValue</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">secretsmanager:DescribeSecret</span>
                <span class="nt">Resource</span><span class="p">:</span> 
                  <span class="p p-Indicator">-</span> <span class="kt">!Ref</span> <span class="s">&#39;ADAdminSecrets&#39;</span>
                  <span class="p p-Indicator">-</span> <span class="kt">!Ref</span> <span class="s">&#39;RestoreModeSecrets&#39;</span>
                  <span class="p p-Indicator">-</span> <span class="kt">!Ref</span> <span class="s">&#39;ADAltUserSecrets&#39;</span>
              <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
                <span class="nt">Action</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ssm:StartAutomationExecution</span>
                <span class="nt">Resource</span><span class="p">:</span> <span class="s">&#39;*&#39;</span>
          <span class="nt">PolicyName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AD-SSM-Secrets</span>
        <span class="p p-Indicator">-</span> <span class="nt">PolicyDocument</span><span class="p">:</span>
            <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
            <span class="nt">Statement</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
                <span class="nt">Action</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">iam:PassRole</span>
                <span class="nt">Resource</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:aws:iam::${AWS::AccountId}:role/${AWSQuickstartADDSRole}&#39;</span>
          <span class="nt">PolicyName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AD-SSM-PassRole</span>
      <span class="nt">Path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
      <span class="nt">ManagedPolicyArns</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:${AWS::Partition}:iam::aws:policy/AmazonSSMManagedInstanceCore&#39;</span>
        <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:${AWS::Partition}:iam::aws:policy/CloudWatchAgentServerPolicy&#39;</span>
      <span class="nt">AssumeRolePolicyDocument</span><span class="p">:</span>
        <span class="nt">Statement</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">Action</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">sts:AssumeRole</span>
            <span class="nt">Principal</span><span class="p">:</span>
              <span class="nt">Service</span><span class="p">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ec2.amazonaws.com</span>
            <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
        <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
  <span class="nt">ADServerProfile</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::IAM::InstanceProfile</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Roles</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="kt">!Ref</span> <span class="s">&#39;ADServerRole&#39;</span>
      <span class="nt">Path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
  <span class="nt">ADAdminSecrets</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::SecretsManager::Secret</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Name</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;ADAdministratorSecret-${AWS::StackName}&#39;</span>
      <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Administrator Password for AD Quick Start</span>
      <span class="nt">GenerateSecretString</span><span class="p">:</span>
        <span class="nt">SecretStringTemplate</span><span class="p">:</span> <span class="s">&#39;{&quot;username&quot;:</span><span class="nv"> </span><span class="s">&quot;Administrator&quot;}&#39;</span>
        <span class="nt">GenerateStringKey</span><span class="p">:</span> <span class="s">&quot;password&quot;</span>
        <span class="nt">PasswordLength</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
        <span class="nt">ExcludeCharacters</span><span class="p">:</span> <span class="s">&#39;&quot;@/\&#39;</span>
  <span class="nt">RestoreModeSecrets</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::SecretsManager::Secret</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Name</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;RestoreModeSecrets-${AWS::StackName}&#39;</span>
      <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Restore Mode Password for AD Quick Start</span>
      <span class="nt">GenerateSecretString</span><span class="p">:</span>
        <span class="nt">SecretStringTemplate</span><span class="p">:</span> <span class="s">&#39;{&quot;username&quot;:</span><span class="nv"> </span><span class="s">&quot;Administrator&quot;}&#39;</span>
        <span class="nt">GenerateStringKey</span><span class="p">:</span> <span class="s">&quot;password&quot;</span>
        <span class="nt">PasswordLength</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
        <span class="nt">ExcludeCharacters</span><span class="p">:</span> <span class="s">&#39;&quot;@/\&#39;</span>
  <span class="nt">ADAltUserSecrets</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::SecretsManager::Secret</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Name</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;ADAltUserSecrets-${AWS::StackName}&#39;</span>
      <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Alternate AD Admin User from AD Quick Start</span>
      <span class="nt">SecretString</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;{&quot;username&quot;:&quot;${DomainAdminUser}&quot;,&quot;password&quot;:&quot;${DomainAdminPassword}&quot;}&#39;</span>
  <span class="nt">DomainJoinSecrets</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::SecretsManager::Secret</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Name</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;DomainJoinSecrets-${AWS::StackName}&#39;</span>
      <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Alternate AD Admin User from AD Quick Start</span>
      <span class="nt">SecretString</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&#39;{&quot;username&quot;:&quot;${DomainNetBIOSName}\\${DomainAdminUser}&quot;,&quot;password&quot;:&quot;${DomainAdminPassword}&quot;}&#39;</span>
  <span class="nt">DomainNameParam</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="s">&quot;AWS::SSM::Parameter&quot;</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Name</span><span class="p">:</span> <span class="s">&quot;/demo/AD/DomainName&quot;</span>
      <span class="nt">Type</span><span class="p">:</span> <span class="s">&quot;String&quot;</span>
      <span class="nt">Value</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;DomainDNSName&#39;</span>
      <span class="nt">Description</span><span class="p">:</span> <span class="s">&quot;SSM</span><span class="nv"> </span><span class="s">Parameter</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">Domain</span><span class="nv"> </span><span class="s">Name.&quot;</span>
  <span class="nt">DomainController1</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Instance</span>
    <span class="nt">CreationPolicy</span><span class="p">:</span>
      <span class="nt">ResourceSignal</span><span class="p">:</span>
        <span class="nt">Timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PT60M</span>
        <span class="nt">Count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">ImageId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;WS2016FULLBASE&#39;</span>
      <span class="nt">IamInstanceProfile</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;ADServerProfile&#39;</span>
      <span class="nt">InstanceType</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;ADServer1InstanceType&#39;</span>
      <span class="nt">SubnetId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;PrivateSubnet1ID&#39;</span>
      <span class="nt">Tags</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">Key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Name</span>
          <span class="nt">Value</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;ADServer1NetBIOSName&#39;</span>
      <span class="nt">BlockDeviceMappings</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">DeviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/sda1</span>
          <span class="nt">Ebs</span><span class="p">:</span>
            <span class="nt">VolumeSize</span><span class="p">:</span> <span class="s">&#39;100&#39;</span>
            <span class="nt">VolumeType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gp2</span>
      <span class="nt">SecurityGroupIds</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="kt">!Ref</span> <span class="s">&#39;DomainControllersSG&#39;</span>
      <span class="nt">PrivateIpAddress</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;ADServer1PrivateIP&#39;</span>
      <span class="nt">UserData</span><span class="p">:</span> <span class="kt">!Base64</span>
        <span class="l l-Scalar l-Scalar-Plain">Fn::Join</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&#39;&#39;</span>
          <span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="s">&quot;&lt;powershell&gt;\n&quot;</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;Start-SSMAutomationExecution</span><span class="nv"> </span><span class="s">-DocumentName</span><span class="nv"> </span><span class="s">&#39;</span>
            <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;&quot;${AWSQuickstartActiveDirectoryDS}&quot;&#39;</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;</span><span class="nv"> </span><span class="s">-Parameter</span><span class="nv"> </span><span class="s">@{&#39;</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;&quot;ADServer1NetBIOSName&quot;=&#39;</span>
            <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;&quot;${ADServer1NetBIOSName}&quot;&#39;</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;;&quot;ADServer1PrivateIP&quot;=&#39;</span>
            <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;&quot;${ADServer1PrivateIP}&quot;&#39;</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;;&quot;DomainDNSName&quot;=&#39;</span>
            <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;&quot;${DomainDNSName}&quot;&#39;</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;;&quot;DomainNetBIOSName&quot;=&#39;</span>
            <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;&quot;${DomainNetBIOSName}&quot;&#39;</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;;&quot;VPCCIDR&quot;=&#39;</span>
            <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;&quot;${VPCCIDR}&quot;&#39;</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;;&quot;QSS3BucketName&quot;=&#39;</span>
            <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;&quot;${QSS3BucketName}&quot;&#39;</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;;&quot;QSS3KeyPrefix&quot;=&#39;</span>
            <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;&quot;${QSS3KeyPrefix}&quot;&#39;</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;;&quot;ADAdminSecParamName&quot;=&#39;</span>
            <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;&quot;${ADAdminSecrets}&quot;&#39;</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;;&quot;ADAltUserSecParamName&quot;=&#39;</span>
            <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;&quot;${ADAltUserSecrets}&quot;&#39;</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;;&quot;RestoreModeSecParamName&quot;=&#39;</span>
            <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;&quot;${RestoreModeSecrets}&quot;&#39;</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;;&quot;StackName&quot;=&#39;</span>
            <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;&quot;${AWS::StackName}&quot;&#39;</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;;&quot;URLSuffix&quot;=&#39;</span>
            <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;&quot;${AWS::URLSuffix}&quot;&#39;</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;;&quot;AutomationAssumeRole&quot;=&#39;</span>
            <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;&quot;arn:${AWS::Partition}:iam::${AWS::AccountId}:role/${AWSQuickstartADDSRole}&quot;&#39;</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;}&#39;</span>
            <span class="p p-Indicator">-</span> <span class="s">&quot;\n&quot;</span>
            <span class="p p-Indicator">-</span> <span class="s">&quot;&lt;/powershell&gt;\n&quot;</span>
  <span class="nt">DomainControllersSG</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SecurityGroup</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">GroupDescription</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain Controllers Security Group</span>
      <span class="nt">VpcId</span><span class="p">:</span>
        <span class="nt">Ref</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">VPCID</span>
      <span class="nt">SecurityGroupIngress</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5985</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5985</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">VPCCIDR</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">VPCCIDR</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">53</span> 
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">53</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">VPCCIDR</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">53</span> 
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">53</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">VPCCIDR</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3389</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3389</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">VPCCIDR</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">123</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">123</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">135</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">135</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">9389</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">9389</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">138</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">138</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">445</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">445</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">445</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">445</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">464</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">464</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">464</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">464</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">49152</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">65535</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">49152</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">65535</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">389</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">389</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">389</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">389</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">636</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">636</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3268</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3268</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3269</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3269</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">9389</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">9389</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">88</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">88</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">88</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">88</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5355</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5355</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">137</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">137</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">139</span> 
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">139</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span> 
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5722</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5722</span>
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">icmp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-1</span> 
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-1</span> 
          <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainMembersSG</span>
  <span class="nt">DomainMembersSG</span><span class="p">:</span> 
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SecurityGroup</span>
    <span class="nt">Properties</span><span class="p">:</span> 
      <span class="nt">GroupDescription</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain Members</span>
      <span class="nt">VpcId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">VPCID</span>
      <span class="nt">SecurityGroupIngress</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5985</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5985</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">VPCCIDR</span>
        <span class="p p-Indicator">-</span> <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3389</span>
          <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3389</span>
          <span class="nt">CidrIp</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">VPCCIDR</span>
  <span class="nt">DCSecurityGroupIngress</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SecurityGroupIngress</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Security Group Rule between Domain Controllers</span> 
      <span class="nt">GroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainControllersSG</span>
      <span class="nt">IpProtocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-1</span> 
      <span class="nt">FromPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-1</span> 
      <span class="nt">ToPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-1</span> 
      <span class="nt">SourceSecurityGroupId</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DomainControllersSG</span>
  <span class="nt">LambdaSSMRole</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::IAM::Role</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Policies</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">PolicyDocument</span><span class="p">:</span>
            <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
            <span class="nt">Statement</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
              <span class="nt">Action</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">s3:PutObject</span>
              <span class="nt">Resource</span><span class="p">:</span>
                <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&quot;${DSCBucket.Arn}&quot;</span>
                <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&quot;${DSCBucket.Arn}/*&quot;</span>
          <span class="nt">PolicyName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">write-mof-s3</span>
      <span class="nt">Path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
      <span class="nt">AssumeRolePolicyDocument</span><span class="p">:</span>
        <span class="nt">Version</span><span class="p">:</span> <span class="s">&#39;2012-10-17&#39;</span>
        <span class="nt">Statement</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">Effect</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
            <span class="nt">Principal</span><span class="p">:</span>
              <span class="nt">Service</span><span class="p">:</span> 
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lambda.amazonaws.com</span>
            <span class="nt">Action</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sts:AssumeRole</span>
      <span class="nt">ManagedPolicyArns</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&#39;arn:${AWS::Partition}:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole&#39;</span>
  <span class="nt">WriteMOFFunction</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::Lambda::Function</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">Code</span><span class="p">:</span>
        <span class="nt">ZipFile</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
          <span class="no">var AWS = require(&#39;aws-sdk&#39;), s3 = new AWS.S3();</span>
          <span class="no">const response = require(&quot;cfn-response&quot;);</span>
          <span class="no">exports.handler = async (event, context) =&gt; {</span>
            <span class="no">console.log(JSON.stringify(event));</span>
            <span class="no">if (event.RequestType === &#39;Delete&#39;) {</span>
                <span class="no">await postResponse(event, context, response.SUCCESS, {})</span>
                <span class="no">return;</span>
            <span class="no">}</span>
            <span class="no">function postResponse(event, context, status, data){</span>
                <span class="no">return new Promise((resolve, reject) =&gt; {</span>
                    <span class="no">setTimeout(() =&gt; response.send(event, context, status, data), 5000)</span>
                <span class="no">});</span>
            <span class="no">}</span>
            <span class="no">await s3.putObject({</span>
              <span class="no">Body: event.ResourceProperties.Body,</span>
              <span class="no">Bucket: event.ResourceProperties.Bucket,</span>
              <span class="no">Key: event.ResourceProperties.Key</span>
            <span class="no">}).promise();</span>
            <span class="no">await postResponse(event, context, response.SUCCESS, {});</span>
          <span class="no">};</span>
      <span class="nt">Handler</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">index.handler</span>
      <span class="nt">Role</span><span class="p">:</span> <span class="kt">!GetAtt</span> <span class="l l-Scalar l-Scalar-Plain">LambdaSSMRole.Arn</span>
      <span class="nt">Runtime</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nodejs10.x</span>
      <span class="nt">Timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
  <span class="nt">WriteDomainJoinMOF</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Custom::WriteMOFFile</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="nt">ServiceToken</span><span class="p">:</span> <span class="kt">!GetAtt</span> <span class="l l-Scalar l-Scalar-Plain">WriteMOFFunction.Arn</span>
      <span class="nt">Bucket</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DSCBucket</span>
      <span class="nt">Key</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="s">&quot;DomainJoin-${AWS::StackName}.mof&quot;</span>
      <span class="nt">Body</span><span class="p">:</span> <span class="kt">!Sub</span> <span class="p p-Indicator">|</span>
        <span class="no">/*</span>
        <span class="no">@TargetNode=&#39;localhost&#39;</span>
        <span class="no">*/</span>
        <span class="no">instance of MSFT_Credential as $MSFT_Credential1ref</span>
        <span class="no">{</span>
        <span class="no">Password = &quot;managementgovernancesample&quot;;</span>
         <span class="no">UserName = &quot;${DomainJoinSecrets}&quot;;</span>

        <span class="no">};</span>
        <span class="no">instance of DSC_Computer as $DSC_Computer1ref</span>
        <span class="no">{</span>
        <span class="no">ResourceID = &quot;[Computer]JoinDomain&quot;;</span>
         <span class="no">Credential = $MSFT_Credential1ref;</span>
         <span class="no">DomainName = &quot;{tag:DomainToJoin}&quot;;</span>
         <span class="no">Name = &quot;{tag:Name}&quot;;</span>
         <span class="no">ModuleName = &quot;ComputerManagementDsc&quot;;</span>
         <span class="no">ModuleVersion = &quot;8.0.0&quot;;</span>
         <span class="no">ConfigurationName = &quot;DomainJoin&quot;;</span>
        <span class="no">};</span>
        <span class="no">instance of OMI_ConfigurationDocument</span>
                            <span class="no">{</span>
         <span class="no">Version=&quot;2.0.0&quot;;</span>
                                <span class="no">MinimumCompatibleVersion = &quot;1.0.0&quot;;</span>
                                <span class="no">CompatibleVersionAdditionalProperties= {&quot;Omi_BaseResource:ConfigurationName&quot;};</span>
                                <span class="no">Name=&quot;DomainJoin&quot;;</span>
                            <span class="no">};      </span>
  <span class="nt">DomainJoinAssociation</span><span class="p">:</span>
    <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS::SSM::Association</span>
    <span class="nt">Properties</span><span class="p">:</span>
      <span class="c1"># We are using the AWS-ApplyDSCMofs Document</span>
      <span class="nt">Name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS-ApplyDSCMofs</span>
      <span class="nt">Targets</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">Key</span><span class="p">:</span> <span class="s">&quot;tag:DomainToJoin&quot;</span>
          <span class="nt">Values</span><span class="p">:</span>
           <span class="p p-Indicator">-</span> <span class="kt">!Ref</span> <span class="s">&quot;DomainDNSName&quot;</span>
      <span class="nt">OutputLocation</span><span class="p">:</span>
        <span class="nt">S3Location</span><span class="p">:</span> 
          <span class="nt">OutputS3BucketName</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="l l-Scalar l-Scalar-Plain">DSCBucket</span>
          <span class="nt">OutputS3KeyPrefix</span><span class="p">:</span> <span class="s">&#39;logs/&#39;</span>
      <span class="c1"># Here we have a Cron Expression that will run this everyday at 23:15 every day</span>
      <span class="nt">ScheduleExpression</span><span class="p">:</span> <span class="s">&quot;cron(15</span><span class="nv"> </span><span class="s">23</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">?</span><span class="nv"> </span><span class="s">*)&quot;</span>
      <span class="nt">Parameters</span><span class="p">:</span>
        <span class="c1"># Here the Mof file resides in a S3 Bucket, notice the way that S3 is being referenced here. </span>
        <span class="nt">MofsToApply</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="kt">!Sub</span> <span class="s">&quot;s3:${DSCBucket}:DomainJoin-${AWS::StackName}.mof&quot;</span>
        <span class="nt">ServicePath</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
        <span class="nt">MofOperationMode</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Apply</span>
        <span class="nt">ComplianceType</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Custom:DomainJoinSample</span>
        <span class="nt">ModuleSourceBucketName</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;NONE&quot;</span>
        <span class="nt">AllowPSGalleryModuleSource</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;True&quot;</span>
        <span class="nt">RebootBehavior</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;AfterMof&quot;</span>
        <span class="nt">UseComputerNameForReporting</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;False&quot;</span>
        <span class="nt">EnableVerboseLogging</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;False&quot;</span>
        <span class="nt">EnableDebugLogging</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;False&quot;</span>
<span class="nt">Outputs</span><span class="p">:</span>
  <span class="nt">DomainAdmin</span><span class="p">:</span>
    <span class="nt">Value</span><span class="p">:</span> <span class="kt">!Join</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;&#39;</span>
      <span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="kt">!Ref</span> <span class="s">&#39;DomainNetBIOSName&#39;</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">\</span>
        <span class="p p-Indicator">-</span> <span class="kt">!Ref</span> <span class="s">&#39;DomainAdminUser&#39;</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain administrator account</span>
  <span class="nt">DomainMemberSGID</span><span class="p">:</span>
    <span class="nt">Value</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;DomainMembersSG&#39;</span>
    <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain Member Security Group ID</span>
  <span class="nt">SecretsArn</span><span class="p">:</span>
    <span class="nt">Value</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;DomainJoinSecrets&#39;</span>
  <span class="nt">DSCBucket</span><span class="p">:</span>
    <span class="nt">Value</span><span class="p">:</span> <span class="kt">!Ref</span> <span class="s">&#39;DSCBucket&#39;</span>
</pre></div>

<h2 id="lab-cloud-endure">Lab CLoud Endure<a class="headerlink" href="#lab-cloud-endure" title="Permanent link">&para;</a></h2>
<p><a href="https://winonaws.cloud/cloudendure/en/">Guide</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../vmware/" title="VmWare" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                VmWare
              </span>
            </div>
          </a>
        
        
          <a href="../sqlserver/" title="SqlServer" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                SqlServer
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 Fabio Santos
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.dc02f8ce.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script>
      
        <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
      
    
  </body>
</html>
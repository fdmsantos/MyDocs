



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="My Docs">
      
      
      
        <meta name="author" content="Fábio Santos">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.1">
    
    
      
        <title>Hardway - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.3020aac5.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../../../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="https://cdn.rawgit.com/knsv/mermaid/0.5.6/dist/mermaid.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#master" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../.." title="My Docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              My Docs
            </span>
            <span class="md-header-nav__topic">
              Hardway
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../../.." title="Index" class="md-tabs__link">
        Index
      </a>
    
  </li>

      
        
  
  
    
    
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../aws/compute/ec2/" title="Platforms" class="md-tabs__link">
          Platforms
        </a>
      
    </li>
  

  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../devops/terraform/" title="DevOps" class="md-tabs__link">
          DevOps
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../databases/elasticsearch/search/" title="Databases" class="md-tabs__link">
          Databases
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../developer/python/packages/" title="Developer" class="md-tabs__link">
          Developer
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../certifications/kubernetes/ckad/" title="Certifications" class="md-tabs__link">
          Certifications
        </a>
      
    </li>
  

  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../.." title="My Docs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../.." title="Index" class="md-nav__link">
      Index
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Platforms
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Platforms
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      AWS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        AWS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1-1" type="checkbox" id="nav-2-1-1">
    
    <label class="md-nav__link" for="nav-2-1-1">
      Compute
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-1">
        Compute
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/compute/ec2/" title="EC2" class="md-nav__link">
      EC2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/compute/ebs/" title="EBS" class="md-nav__link">
      EBS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/compute/elb/" title="ELB" class="md-nav__link">
      ELB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/compute/eks/" title="EKS" class="md-nav__link">
      EKS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1-2" type="checkbox" id="nav-2-1-2">
    
    <label class="md-nav__link" for="nav-2-1-2">
      Severless
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-2">
        Severless
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/serverless/lambda/" title="Lambda" class="md-nav__link">
      Lambda
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/serverless/apigateway/" title="ApiGateway" class="md-nav__link">
      ApiGateway
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/serverless/amplify/" title="Amplify" class="md-nav__link">
      Amplify
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/serverless/cognito/" title="Cognito" class="md-nav__link">
      Cognito
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/serverless/stepfunctions/" title="StepFunctions" class="md-nav__link">
      StepFunctions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1-3" type="checkbox" id="nav-2-1-3">
    
    <label class="md-nav__link" for="nav-2-1-3">
      Databases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-3">
        Databases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/databases/rds/" title="RDS" class="md-nav__link">
      RDS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/databases/dynamodb/" title="DynamoDB" class="md-nav__link">
      DynamoDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/databases/elasticache/" title="Elasticache" class="md-nav__link">
      Elasticache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/databases/redshift/" title="Redshift" class="md-nav__link">
      Redshift
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1-4" type="checkbox" id="nav-2-1-4">
    
    <label class="md-nav__link" for="nav-2-1-4">
      DevOps
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-4">
        DevOps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/devops/cloudwatch/" title="CloudWatch" class="md-nav__link">
      CloudWatch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/devops/cloudformation/" title="Cloudformation" class="md-nav__link">
      Cloudformation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1-5" type="checkbox" id="nav-2-1-5">
    
    <label class="md-nav__link" for="nav-2-1-5">
      Storage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-5">
        Storage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/storage/s3/" title="S3" class="md-nav__link">
      S3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1-6" type="checkbox" id="nav-2-1-6">
    
    <label class="md-nav__link" for="nav-2-1-6">
      Security
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-6">
        Security
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/security/acm/" title="ACM" class="md-nav__link">
      ACM
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1-7" type="checkbox" id="nav-2-1-7">
    
    <label class="md-nav__link" for="nav-2-1-7">
      Migrate
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-7">
        Migrate
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws/migrate/vmware/" title="VmWare" class="md-nav__link">
      VmWare
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2" checked>
    
    <label class="md-nav__link" for="nav-2-2">
      Kubernetes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Kubernetes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2-1" type="checkbox" id="nav-2-2-1" checked>
    
    <label class="md-nav__link" for="nav-2-2-1">
      Admin
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-2-1">
        Admin
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../admin/" title="Administrator" class="md-nav__link">
      Administrator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../etcd/" title="Etcd" class="md-nav__link">
      Etcd
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kubecontrollermanager/" title="KubeControllerManager" class="md-nav__link">
      KubeControllerManager
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../monitoring/" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../networking/" title="Networking" class="md-nav__link">
      Networking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Hardway
      </label>
    
    <a href="./" title="Hardway" class="md-nav__link md-nav__link--active">
      Hardway
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#master" title="Master" class="md-nav__link">
    Master
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-server" title="API-Server" class="md-nav__link">
    API-Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controller-manager" title="Controller Manager" class="md-nav__link">
    Controller Manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheduler" title="Scheduler" class="md-nav__link">
    Scheduler
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-scheduler" title="Default Scheduler" class="md-nav__link">
    Default Scheduler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-scheduler" title="Custom Scheduler" class="md-nav__link">
    Custom Scheduler
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clusterrole" title="ClusterRole" class="md-nav__link">
    ClusterRole
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clusterrolebinding" title="ClusterRoleBinding" class="md-nav__link">
    ClusterRoleBinding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role" title="Role" class="md-nav__link">
    Role
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rolebinding" title="RoleBinding" class="md-nav__link">
    RoleBinding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-scheduler_1" title="Custom-scheduler" class="md-nav__link">
    Custom-scheduler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy" title="Deploy" class="md-nav__link">
    Deploy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-config" title="Get config" class="md-nav__link">
    Get config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting" title="Troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rbac" title="RBAC" class="md-nav__link">
    RBAC
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nodes" title="Nodes" class="md-nav__link">
    Nodes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install" title="Install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containerd" title="ContainerD" class="md-nav__link">
    ContainerD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubelet" title="Kubelet" class="md-nav__link">
    Kubelet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kube-proxy" title="Kube-Proxy" class="md-nav__link">
    Kube-Proxy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#commands" title="Commands" class="md-nav__link">
    Commands
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#components-status" title="Components Status" class="md-nav__link">
    Components Status
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-http-health-checks" title="Enable HTTP Health Checks" class="md-nav__link">
    Enable HTTP Health Checks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-nginx-load-balancer" title="Using Nginx Load Balancer" class="md-nav__link">
    Using Nginx Load Balancer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kops/" title="Kops" class="md-nav__link">
      Kops
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2-2" type="checkbox" id="nav-2-2-2">
    
    <label class="md-nav__link" for="nav-2-2-2">
      Developer
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-2-2">
        Developer
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/pods/" title="Pods" class="md-nav__link">
      Pods
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/daemonsets/" title="DaemonSets" class="md-nav__link">
      DaemonSets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/deployments/" title="Deployments" class="md-nav__link">
      Deployments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/ingress/" title="Ingress" class="md-nav__link">
      Ingress
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/jobs/" title="Jobs" class="md-nav__link">
      Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/volumes/" title="Volumes" class="md-nav__link">
      Volumes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/replicasets/" title="Replicasets" class="md-nav__link">
      Replicasets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/secrets_configmaps/" title="Secrets&ConfigMaps" class="md-nav__link">
      Secrets&ConfigMaps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/services/" title="Services" class="md-nav__link">
      Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/statefulsets/" title="StatefulSets" class="md-nav__link">
      StatefulSets
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Unix
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Unix
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix/commands/" title="Commands" class="md-nav__link">
      Commands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix/disks/" title="Disks" class="md-nav__link">
      Disks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix/networking/" title="Networking" class="md-nav__link">
      Networking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix/security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix/redhat/" title="Redhat" class="md-nav__link">
      Redhat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix/debian/" title="Debian" class="md-nav__link">
      Debian
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix/archlinux/" title="Archlinux" class="md-nav__link">
      Archlinux
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix/virsh/" title="Virsh" class="md-nav__link">
      Virsh
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      DevOps
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        DevOps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../devops/terraform/" title="Terraform" class="md-nav__link">
      Terraform
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../devops/packer/" title="Packer" class="md-nav__link">
      Packer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../devops/git/" title="Git" class="md-nav__link">
      Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../devops/jenkins/" title="Jenkins" class="md-nav__link">
      Jenkins
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Databases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Databases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      ElasticSearch
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        ElasticSearch
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/elasticsearch/search/" title="Search" class="md-nav__link">
      Search
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/elasticsearch/indices/" title="Indices" class="md-nav__link">
      Indices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/elasticsearch/cat/" title="Cat" class="md-nav__link">
      Cat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/elasticsearch/beat/" title="Beat" class="md-nav__link">
      Beat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/elasticsearch/kibana/" title="Kibana" class="md-nav__link">
      Kibana
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/elasticsearch/cluster/" title="Cluster" class="md-nav__link">
      Cluster
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/elasticsearch/nodes/" title="Nodes" class="md-nav__link">
      Nodes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/elasticsearch/snapshots/" title="Snapshots" class="md-nav__link">
      Snapshots
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      MySQL
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        MySQL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../databases/mysql/galera-cluster/" title="Galera" class="md-nav__link">
      Galera
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Developer
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Developer
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1">
    
    <label class="md-nav__link" for="nav-5-1">
      Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/python/packages/" title="Packages" class="md-nav__link">
      Packages
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/ciscoAci/cobra/" title="Cisco ACI" class="md-nav__link">
      Cisco ACI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      RobotFramework
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        RobotFramework
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/robotframework/gettingstarted/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/robotframework/ddd/" title="Data-Driver" class="md-nav__link">
      Data-Driver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/robotframework/pom/" title="Page-Object Model" class="md-nav__link">
      Page-Object Model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/robotframework/robotfile/" title="RobotFile" class="md-nav__link">
      RobotFile
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../developer/robotframework/selenium/" title="Selenium" class="md-nav__link">
      Selenium
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Certifications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Certifications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-1" type="checkbox" id="nav-6-1">
    
    <label class="md-nav__link" for="nav-6-1">
      Kubernetes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-1">
        Kubernetes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/kubernetes/ckad/" title="CKAD" class="md-nav__link">
      CKAD
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      AWS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-2">
        AWS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/aws/security-specialty/" title="Security-Specialty" class="md-nav__link">
      Security-Specialty
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-3" type="checkbox" id="nav-6-3">
    
    <label class="md-nav__link" for="nav-6-3">
      Google
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-3">
        Google
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/google/associate-cloud-engineer/" title="Associate-Cloud-Engineer" class="md-nav__link">
      Associate-Cloud-Engineer
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-4" type="checkbox" id="nav-6-4">
    
    <label class="md-nav__link" for="nav-6-4">
      Azure
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-4">
        Azure
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/azure/fundamentals/" title="Fundamentals" class="md-nav__link">
      Fundamentals
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#master" title="Master" class="md-nav__link">
    Master
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-server" title="API-Server" class="md-nav__link">
    API-Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controller-manager" title="Controller Manager" class="md-nav__link">
    Controller Manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheduler" title="Scheduler" class="md-nav__link">
    Scheduler
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-scheduler" title="Default Scheduler" class="md-nav__link">
    Default Scheduler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-scheduler" title="Custom Scheduler" class="md-nav__link">
    Custom Scheduler
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clusterrole" title="ClusterRole" class="md-nav__link">
    ClusterRole
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clusterrolebinding" title="ClusterRoleBinding" class="md-nav__link">
    ClusterRoleBinding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role" title="Role" class="md-nav__link">
    Role
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rolebinding" title="RoleBinding" class="md-nav__link">
    RoleBinding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-scheduler_1" title="Custom-scheduler" class="md-nav__link">
    Custom-scheduler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy" title="Deploy" class="md-nav__link">
    Deploy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-config" title="Get config" class="md-nav__link">
    Get config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting" title="Troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rbac" title="RBAC" class="md-nav__link">
    RBAC
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nodes" title="Nodes" class="md-nav__link">
    Nodes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install" title="Install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containerd" title="ContainerD" class="md-nav__link">
    ContainerD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubelet" title="Kubelet" class="md-nav__link">
    Kubelet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kube-proxy" title="Kube-Proxy" class="md-nav__link">
    Kube-Proxy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#commands" title="Commands" class="md-nav__link">
    Commands
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#components-status" title="Components Status" class="md-nav__link">
    Components Status
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-http-health-checks" title="Enable HTTP Health Checks" class="md-nav__link">
    Enable HTTP Health Checks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-nginx-load-balancer" title="Using Nginx Load Balancer" class="md-nav__link">
    Using Nginx Load Balancer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Hardway</h1>
                
                <h2 id="master">Master<a class="headerlink" href="#master" title="Permanent link">&para;</a></h2>
<ul>
<li>Install</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c1"># You can install the control plane binaries on each master node like this:</span>
sudo mkdir -p /etc/kubernetes/config
wget -q --timestamping <span class="se">\</span>
  <span class="s2">&quot;https://storage.googleapis.com/kubernetes-release/release/v1.10.2/bin/linux/amd64/kube-apiserver&quot;</span> <span class="se">\</span>
  <span class="s2">&quot;https://storage.googleapis.com/kubernetes-release/release/v1.10.2/bin/linux/amd64/kube-controller-manager&quot;</span> <span class="se">\</span>
  <span class="s2">&quot;https://storage.googleapis.com/kubernetes-release/release/v1.10.2/bin/linux/amd64/kube-scheduler&quot;</span> <span class="se">\</span>
  <span class="s2">&quot;https://storage.googleapis.com/kubernetes-release/release/v1.10.2/bin/linux/amd64/kubectl&quot;</span>
chmod +x kube-apiserver kube-controller-manager kube-scheduler kubectl
sudo mv kube-apiserver kube-controller-manager kube-scheduler kubectl /usr/local/bin/
</pre></div>

<h3 id="api-server">API-Server<a class="headerlink" href="#api-server" title="Permanent link">&para;</a></h3>
<ul>
<li>Setting Up</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c1"># You can configure the Kubernetes API server like so:</span>
sudo mkdir -p /var/lib/kubernetes/
sudo cp ca.pem ca-key.pem kubernetes-key.pem kubernetes.pem <span class="se">\</span>
  service-account-key.pem service-account.pem <span class="se">\</span>
  encryption-config.yaml /var/lib/kubernetes/

<span class="c1"># Set some environment variables that will be used to create the systemd unit file. Make sure you replace the placeholders with their actual values:</span>
<span class="nb">export</span> <span class="nv">INTERNAL_IP</span><span class="o">=</span><span class="k">$(</span>curl http://169.254.169.254/latest/meta-data/local-ipv4<span class="k">)</span>
<span class="nb">export</span> <span class="nv">CONTROLLER0_IP</span><span class="o">=</span>&lt;private ip of controller <span class="m">0</span>&gt;
<span class="nb">export</span> <span class="nv">CONTROLLER1_IP</span><span class="o">=</span>&lt;private ip of controller <span class="m">1</span>&gt;

<span class="c1"># Generate the kube-apiserver unit file for systemd:</span>
cat <span class="s">&lt;&lt; EOF | sudo tee /etc/systemd/system/kube-apiserver.service</span>
<span class="s">[Unit]</span>
<span class="s">Description=Kubernetes API Server</span>
<span class="s">Documentation=https://github.com/kubernetes/kubernetes</span>

<span class="s">[Service]</span>
<span class="s">ExecStart=/usr/local/bin/kube-apiserver \\</span>
<span class="s">  --advertise-address=${INTERNAL_IP} \\</span>
<span class="s">  --allow-privileged=true \\</span>
<span class="s">  --apiserver-count=3 \\</span>
<span class="s">  --audit-log-maxage=30 \\</span>
<span class="s">  --audit-log-maxbackup=3 \\</span>
<span class="s">  --audit-log-maxsize=100 \\</span>
<span class="s">  --audit-log-path=/var/log/audit.log \\</span>
<span class="s">  --authorization-mode=Node,RBAC \\</span>
<span class="s">  --bind-address=0.0.0.0 \\</span>
<span class="s">  --client-ca-file=/var/lib/kubernetes/ca.pem \\</span>
<span class="s">  --enable-admission-plugins=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota \\</span>
<span class="s">  --enable-swagger-ui=true \\</span>
<span class="s">  --etcd-cafile=/var/lib/kubernetes/ca.pem \\</span>
<span class="s">  --etcd-certfile=/var/lib/kubernetes/kubernetes.pem \\</span>
<span class="s">  --etcd-keyfile=/var/lib/kubernetes/kubernetes-key.pem \\</span>
<span class="s">  --etcd-servers=https://$CONTROLLER0_IP:2379,https://$CONTROLLER1_IP:2379 \\</span>
<span class="s">  --event-ttl=1h \\</span>
<span class="s">  --experimental-encryption-provider-config=/var/lib/kubernetes/encryption-config.yaml \\</span>
<span class="s">  --kubelet-certificate-authority=/var/lib/kubernetes/ca.pem \\</span>
<span class="s">  --kubelet-client-certificate=/var/lib/kubernetes/kubernetes.pem \\</span>
<span class="s">  --kubelet-client-key=/var/lib/kubernetes/kubernetes-key.pem \\</span>
<span class="s">  --kubelet-https=true \\</span>
<span class="s">  --runtime-config=api/all \\</span>
<span class="s">  --service-account-key-file=/var/lib/kubernetes/service-account.pem \\</span>
<span class="s">  --service-cluster-ip-range=10.32.0.0/24 \\</span>
<span class="s">  --service-node-port-range=30000-32767 \\</span>
<span class="s">  --tls-cert-file=/var/lib/kubernetes/kubernetes.pem \\</span>
<span class="s">  --tls-private-key-file=/var/lib/kubernetes/kubernetes-key.pem \\</span>
<span class="s">  --v=2 \\</span>
<span class="s">  --kubelet-preferred-address-types=InternalIP,InternalDNS,Hostname,ExternalIP,ExternalDNS</span>
<span class="s">Restart=on-failure</span>
<span class="s">RestartSec=5</span>

<span class="s">[Install]</span>
<span class="s">WantedBy=multi-user.target</span>
<span class="s">EOF</span>

<span class="c1"># Start and enable the service:</span>

sudo systemctl daemon-reload
sudo systemctl <span class="nb">enable</span> kube-apiserver
sudo systemctl start kube-apiserver
sudo systemctl status kube-apiserver
</pre></div>

<h3 id="controller-manager">Controller Manager<a class="headerlink" href="#controller-manager" title="Permanent link">&para;</a></h3>
<ul>
<li>Setting Up</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c1"># You can configure the Kubernetes Controller Manager like so:</span>
sudo cp kube-controller-manager.kubeconfig /var/lib/kubernetes/

<span class="c1"># Generate the kube-controller-manager systemd unit file:</span>
cat <span class="s">&lt;&lt; EOF | sudo tee /etc/systemd/system/kube-controller-manager.service</span>
<span class="s">[Unit]</span>
<span class="s">Description=Kubernetes Controller Manager</span>
<span class="s">Documentation=https://github.com/kubernetes/kubernetes</span>

<span class="s">[Service]</span>
<span class="s">ExecStart=/usr/local/bin/kube-controller-manager \\</span>
<span class="s">  --address=0.0.0.0 \\</span>
<span class="s">  --cluster-cidr=10.200.0.0/16 \\</span>
<span class="s">  --cluster-name=kubernetes \\</span>
<span class="s">  --cluster-signing-cert-file=/var/lib/kubernetes/ca.pem \\</span>
<span class="s">  --cluster-signing-key-file=/var/lib/kubernetes/ca-key.pem \\</span>
<span class="s">  --kubeconfig=/var/lib/kubernetes/kube-controller-manager.kubeconfig \\</span>
<span class="s">  --leader-elect=true \\</span>
<span class="s">  --root-ca-file=/var/lib/kubernetes/ca.pem \\</span>
<span class="s">  --service-account-private-key-file=/var/lib/kubernetes/service-account-key.pem \\</span>
<span class="s">  --service-cluster-ip-range=10.32.0.0/24 \\</span>
<span class="s">  --use-service-account-credentials=true \\</span>
<span class="s">  --v=2</span>
<span class="s">Restart=on-failure</span>
<span class="s">RestartSec=5</span>

<span class="s">[Install]</span>
<span class="s">WantedBy=multi-user.target</span>
<span class="s">EOF</span>

<span class="c1"># Start and enable the service:</span>
sudo systemctl daemon-reload
sudo systemctl <span class="nb">enable</span> kube-controller-manager
sudo systemctl start kube-controller-manager
sudo systemctl status kube-controller-manager
</pre></div>

<h3 id="scheduler">Scheduler<a class="headerlink" href="#scheduler" title="Permanent link">&para;</a></h3>
<ul>
<li>Setting Up</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c1"># Copy kube-scheduler.kubeconfig into the proper location:</span>
sudo cp kube-scheduler.kubeconfig /var/lib/kubernetes/

<span class="c1"># Generate the kube-scheduler yaml config file.</span>
cat <span class="s">&lt;&lt; EOF | sudo tee /etc/kubernetes/config/kube-scheduler.yaml</span>
<span class="s">apiVersion: componentconfig/v1alpha1</span>
<span class="s">kind: KubeSchedulerConfiguration</span>
<span class="s">clientConnection:</span>
<span class="s">  kubeconfig: &quot;/var/lib/kubernetes/kube-scheduler.kubeconfig&quot;</span>
<span class="s">leaderElection:</span>
<span class="s">  leaderElect: true</span>
<span class="s">EOF</span>

<span class="c1"># Create the kube-scheduler systemd unit file:</span>
cat <span class="s">&lt;&lt; EOF | sudo tee /etc/systemd/system/kube-scheduler.service</span>
<span class="s">[Unit]</span>
<span class="s">Description=Kubernetes Scheduler</span>
<span class="s">Documentation=https://github.com/kubernetes/kubernetes</span>

<span class="s">[Service]</span>
<span class="s">ExecStart=/usr/local/bin/kube-scheduler \\</span>
<span class="s">  --config=/etc/kubernetes/config/kube-scheduler.yaml \\</span>
<span class="s">  --v=2</span>
<span class="s">Restart=on-failure</span>
<span class="s">RestartSec=5</span>

<span class="s">[Install]</span>
<span class="s">WantedBy=multi-user.target</span>
<span class="s">EOF</span>

<span class="c1"># Start and enable the service:</span>
sudo systemctl daemon-reload
sudo systemctl <span class="nb">enable</span> kube-scheduler
sudo systemctl start kube-scheduler
sudo systemctl status kube-scheduler
</pre></div>

<h4 id="default-scheduler">Default Scheduler<a class="headerlink" href="#default-scheduler" title="Permanent link">&para;</a></h4>
<ol>
<li>Does the node have adequate hardware resources?</li>
<li>Is the node running out of resources?</li>
<li>Does the pod request a specific node?</li>
<li>Does the node have a matching label?</li>
<li>If the pod requests a port, is it available?</li>
<li>If the pod requests a volume, can it be mounted?</li>
<li>Does the pod tolerate the taints of the node?</li>
<li>Does the pod specify node or pod affinity?</li>
</ol>
<h4 id="custom-scheduler">Custom Scheduler<a class="headerlink" href="#custom-scheduler" title="Permanent link">&para;</a></h4>
<h5 id="clusterrole">ClusterRole<a class="headerlink" href="#clusterrole" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">csinodes-admin</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;storage.k8s.io&quot;</span><span class="p p-Indicator">]</span>
  <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;csinodes&quot;</span><span class="p p-Indicator">]</span>
  <span class="nt">verbs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;list&quot;</span><span class="p p-Indicator">]</span>
</pre></div>

<h5 id="clusterrolebinding">ClusterRoleBinding<a class="headerlink" href="#clusterrolebinding" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">read-csinodes-global</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-scheduler</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nt">roleRef</span><span class="p">:</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">csinodes-admin</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
</pre></div>

<h5 id="role">Role<a class="headerlink" href="#role" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">system:serviceaccount:kube-system:my-scheduler</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">storage.k8s.io</span>
  <span class="nt">resources</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">csinodes</span>
  <span class="nt">verbs</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">get</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">list</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">watch</span>
</pre></div>

<h5 id="rolebinding">RoleBinding<a class="headerlink" href="#rolebinding" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">read-csinodes</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">User</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes-admin</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class="nt">roleRef</span><span class="p">:</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span> 
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">system:serviceaccount:kube-system:my-scheduler</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
</pre></div>

<h5 id="custom-scheduler_1">Custom-scheduler<a class="headerlink" href="#custom-scheduler_1" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-scheduler</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-scheduler-as-kube-scheduler</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-scheduler</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nt">roleRef</span><span class="p">:</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">system:kube-scheduler</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">component</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">scheduler</span>
    <span class="nt">tier</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">control-plane</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-scheduler</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">component</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">scheduler</span>
      <span class="nt">tier</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">control-plane</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">component</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">scheduler</span>
        <span class="nt">tier</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">control-plane</span>
        <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">second</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">serviceAccountName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-scheduler</span>
      <span class="nt">containers</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/usr/local/bin/kube-scheduler</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--address=0.0.0.0</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--leader-elect=false</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--scheduler-name=my-scheduler</span>
        <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chadmcrowell/custom-scheduler</span>
        <span class="nt">livenessProbe</span><span class="p">:</span>
          <span class="nt">httpGet</span><span class="p">:</span>
            <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/healthz</span>
            <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10251</span>
          <span class="nt">initialDelaySeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-second-scheduler</span>
        <span class="nt">readinessProbe</span><span class="p">:</span>
          <span class="nt">httpGet</span><span class="p">:</span>
            <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/healthz</span>
            <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10251</span>
        <span class="nt">resources</span><span class="p">:</span>
          <span class="nt">requests</span><span class="p">:</span>
            <span class="nt">cpu</span><span class="p">:</span> <span class="s">&#39;0.1&#39;</span>
        <span class="nt">securityContext</span><span class="p">:</span>
          <span class="nt">privileged</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
        <span class="nt">volumeMounts</span><span class="p">:</span> <span class="p p-Indicator">[]</span>
      <span class="nt">hostNetwork</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
      <span class="nt">hostPID</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
      <span class="nt">volumes</span><span class="p">:</span> <span class="p p-Indicator">[]</span>
</pre></div>

<h5 id="deploy">Deploy<a class="headerlink" href="#deploy" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span>kubectl create -f clusterrole.yaml
kubectl create -f clusterrolebinding.yaml
kubectl create -f role.yaml
kubectl create -f rolebinding.yaml
kubectl edit clusterrole system:kube-scheduler <span class="c1"># And add the following</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;&quot;</span>
  <span class="nt">resourceNames</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">kube-scheduler</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">my-scheduler</span>
  <span class="nt">resources</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">endpoints</span>
  <span class="nt">verbs</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">delete</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">get</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">patch</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">update</span>
<span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">storage.k8s.io</span>
  <span class="nt">resources</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">storageclasses</span>
  <span class="nt">verbs</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">watch</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">list</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">get</span>
</pre></div>

<div class="codehilite"><pre><span></span>kubectl create -f my-scheduler.yaml
kubectl get pods -n kube-system
</pre></div>

<h4 id="get-config">Get config<a class="headerlink" href="#get-config" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>kubectl get endpoints kube-scheduler -n kube-system -o yaml
</pre></div>

<h4 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>kubectl describe pods <span class="o">[</span>scheduler_pod_name<span class="o">]</span> -n kube-system
kubectl logs <span class="o">[</span>kube_scheduler_pod_name<span class="o">]</span> -n kube-system
cat /var/log/kube-scheduler.log
</pre></div>

<h3 id="rbac">RBAC<a class="headerlink" href="#rbac" title="Permanent link">&para;</a></h3>
<ul>
<li>Setting UP</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c1"># Create a role with the necessary permissions:</span>
cat <span class="s">&lt;&lt; EOF | kubectl apply --kubeconfig admin.kubeconfig -f -</span>
<span class="s">apiVersion: rbac.authorization.k8s.io/v1beta1</span>
<span class="s">kind: ClusterRole</span>
<span class="s">metadata:</span>
<span class="s">  annotations:</span>
<span class="s">    rbac.authorization.kubernetes.io/autoupdate: &quot;true&quot;</span>
<span class="s">  labels:</span>
<span class="s">    kubernetes.io/bootstrapping: rbac-defaults</span>
<span class="s">  name: system:kube-apiserver-to-kubelet</span>
<span class="s">rules:</span>
<span class="s">  - apiGroups:</span>
<span class="s">      - &quot;&quot;</span>
<span class="s">    resources:</span>
<span class="s">      - nodes/proxy</span>
<span class="s">      - nodes/stats</span>
<span class="s">      - nodes/log</span>
<span class="s">      - nodes/spec</span>
<span class="s">      - nodes/metrics</span>
<span class="s">    verbs:</span>
<span class="s">      - &quot;*&quot;</span>
<span class="s">EOF</span>


<span class="c1"># Bind the role to the kubernetes user</span>
cat <span class="s">&lt;&lt; EOF | kubectl apply --kubeconfig admin.kubeconfig -f -</span>
<span class="s">apiVersion: rbac.authorization.k8s.io/v1beta1</span>
<span class="s">kind: ClusterRoleBinding</span>
<span class="s">metadata:</span>
<span class="s">  name: system:kube-apiserver</span>
<span class="s">  namespace: &quot;&quot;</span>
<span class="s">roleRef:</span>
<span class="s">  apiGroup: rbac.authorization.k8s.io</span>
<span class="s">  kind: ClusterRole</span>
<span class="s">  name: system:kube-apiserver-to-kubelet</span>
<span class="s">subjects:</span>
<span class="s">  - apiGroup: rbac.authorization.k8s.io</span>
<span class="s">    kind: User</span>
<span class="s">    name: kubernetes</span>
<span class="s">EOF</span>
</pre></div>

<h2 id="nodes">Nodes<a class="headerlink" href="#nodes" title="Permanent link">&para;</a></h2>
<h3 id="install">Install<a class="headerlink" href="#install" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="c1"># You can install the worker binaries like so. Run these commands on both worker nodes:</span>
sudo apt-get -y install socat conntrack ipset

wget -q --show-progress --https-only --timestamping <span class="se">\</span>
  https://github.com/kubernetes-incubator/cri-tools/releases/download/v1.0.0-beta.0/crictl-v1.0.0-beta.0-linux-amd64.tar.gz <span class="se">\</span>
  https://storage.googleapis.com/kubernetes-the-hard-way/runsc <span class="se">\</span>
  https://github.com/opencontainers/runc/releases/download/v1.0.0-rc5/runc.amd64 <span class="se">\</span>
  https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz <span class="se">\</span>
  https://github.com/containerd/containerd/releases/download/v1.1.0/containerd-1.1.0.linux-amd64.tar.gz <span class="se">\</span>
  https://storage.googleapis.com/kubernetes-release/release/v1.10.2/bin/linux/amd64/kubectl <span class="se">\</span>
  https://storage.googleapis.com/kubernetes-release/release/v1.10.2/bin/linux/amd64/kube-proxy <span class="se">\</span>
  https://storage.googleapis.com/kubernetes-release/release/v1.10.2/bin/linux/amd64/kubelet

sudo mkdir -p <span class="se">\</span>
  /etc/cni/net.d <span class="se">\</span>
  /opt/cni/bin <span class="se">\</span>
  /var/lib/kubelet <span class="se">\</span>
  /var/lib/kube-proxy <span class="se">\</span>
  /var/lib/kubernetes <span class="se">\</span>
  /var/run/kubernetes

chmod +x kubectl kube-proxy kubelet runc.amd64 runsc
sudo mv runc.amd64 runc
sudo mv kubectl kube-proxy kubelet runc runsc /usr/local/bin/
sudo tar -xvf crictl-v1.0.0-beta.0-linux-amd64.tar.gz -C /usr/local/bin/
sudo tar -xvf cni-plugins-amd64-v0.6.0.tgz -C /opt/cni/bin/
sudo tar -xvf containerd-1.1.0.linux-amd64.tar.gz -C /
</pre></div>

<h3 id="containerd">ContainerD<a class="headerlink" href="#containerd" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="c1"># You can configure the containerd service like so. Run these commands on both worker nodes:</span>
sudo mkdir -p /etc/containerd/

<span class="c1"># Create the containerd config.toml:</span>
cat <span class="s">&lt;&lt; EOF | sudo tee /etc/containerd/config.toml</span>
<span class="s">[plugins]</span>
<span class="s">  [plugins.cri.containerd]</span>
<span class="s">    snapshotter = &quot;overlayfs&quot;</span>
<span class="s">    [plugins.cri.containerd.default_runtime]</span>
<span class="s">      runtime_type = &quot;io.containerd.runtime.v1.linux&quot;</span>
<span class="s">      runtime_engine = &quot;/usr/local/bin/runc&quot;</span>
<span class="s">      runtime_root = &quot;&quot;</span>
<span class="s">    [plugins.cri.containerd.untrusted_workload_runtime]</span>
<span class="s">      runtime_type = &quot;io.containerd.runtime.v1.linux&quot;</span>
<span class="s">      runtime_engine = &quot;/usr/local/bin/runsc&quot;</span>
<span class="s">      runtime_root = &quot;/run/containerd/runsc&quot;</span>
<span class="s">EOF</span>

<span class="c1"># Create the containerd unit file:</span>
cat <span class="s">&lt;&lt; EOF | sudo tee /etc/systemd/system/containerd.service</span>
<span class="s">[Unit]</span>
<span class="s">Description=containerd container runtime</span>
<span class="s">Documentation=https://containerd.io</span>
<span class="s">After=network.target</span>

<span class="s">[Service]</span>
<span class="s">ExecStartPre=/sbin/modprobe overlay</span>
<span class="s">ExecStart=/bin/containerd</span>
<span class="s">Restart=always</span>
<span class="s">RestartSec=5</span>
<span class="s">Delegate=yes</span>
<span class="s">KillMode=process</span>
<span class="s">OOMScoreAdjust=-999</span>
<span class="s">LimitNOFILE=1048576</span>
<span class="s">LimitNPROC=infinity</span>
<span class="s">LimitCORE=infinity</span>

<span class="s">[Install]</span>
<span class="s">WantedBy=multi-user.target</span>
<span class="s">EOF</span>


sudo systemctl daemon-reload
sudo systemctl <span class="nb">enable</span> containerd
sudo systemctl start containerd
sudo systemctl status containerd
</pre></div>

<h3 id="kubelet">Kubelet<a class="headerlink" href="#kubelet" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="c1"># Set a HOSTNAME environment variable that will be used to generate your config files. Make sure you set the HOSTNAME appropriately for each worker node:</span>

<span class="nb">export</span> <span class="nv">HOSTNAME</span><span class="o">=</span><span class="k">$(</span>hostname<span class="k">)</span>
sudo mv <span class="si">${</span><span class="nv">HOSTNAME</span><span class="si">}</span>-key.pem <span class="si">${</span><span class="nv">HOSTNAME</span><span class="si">}</span>.pem /var/lib/kubelet/
sudo mv <span class="si">${</span><span class="nv">HOSTNAME</span><span class="si">}</span>.kubeconfig /var/lib/kubelet/kubeconfig
sudo mv ca.pem /var/lib/kubernetes/

<span class="c1"># Create the kubelet config file:</span>
cat <span class="s">&lt;&lt; EOF | sudo tee /var/lib/kubelet/kubelet-config.yaml</span>
<span class="s">kind: KubeletConfiguration</span>
<span class="s">apiVersion: kubelet.config.k8s.io/v1beta1</span>
<span class="s">authentication:</span>
<span class="s">  anonymous:</span>
<span class="s">    enabled: false</span>
<span class="s">  webhook:</span>
<span class="s">    enabled: true</span>
<span class="s">  x509:</span>
<span class="s">    clientCAFile: &quot;/var/lib/kubernetes/ca.pem&quot;</span>
<span class="s">authorization:</span>
<span class="s">  mode: Webhook</span>
<span class="s">clusterDomain: &quot;cluster.local&quot;</span>
<span class="s">clusterDNS: </span>
<span class="s">  - &quot;10.32.0.10&quot;</span>
<span class="s">runtimeRequestTimeout: &quot;15m&quot;</span>
<span class="s">tlsCertFile: &quot;/var/lib/kubelet/${HOSTNAME}.pem&quot;</span>
<span class="s">tlsPrivateKeyFile: &quot;/var/lib/kubelet/${HOSTNAME}-key.pem&quot;</span>
<span class="s">EOF</span>

<span class="c1"># Create the kubelet unit file:</span>

cat <span class="s">&lt;&lt; EOF | sudo tee /etc/systemd/system/kubelet.service</span>
<span class="s">[Unit]</span>
<span class="s">Description=Kubernetes Kubelet</span>
<span class="s">Documentation=https://github.com/kubernetes/kubernetes</span>
<span class="s">After=containerd.service</span>
<span class="s">Requires=containerd.service</span>

<span class="s">[Service]</span>
<span class="s">ExecStart=/usr/local/bin/kubelet \\</span>
<span class="s">  --config=/var/lib/kubelet/kubelet-config.yaml \\</span>
<span class="s">  --container-runtime=remote \\</span>
<span class="s">  --container-runtime-endpoint=unix:///var/run/containerd/containerd.sock \\</span>
<span class="s">  --image-pull-progress-deadline=2m \\</span>
<span class="s">  --kubeconfig=/var/lib/kubelet/kubeconfig \\</span>
<span class="s">  --network-plugin=cni \\</span>
<span class="s">  --register-node=true \\</span>
<span class="s">  --v=2 \\</span>
<span class="s">  --hostname-override=${HOSTNAME} \\</span>
<span class="s">  --allow-privileged=true</span>
<span class="s">Restart=on-failure</span>
<span class="s">RestartSec=5</span>

<span class="s">[Install]</span>
<span class="s">WantedBy=multi-user.target</span>
<span class="s">EOF</span>

sudo systemctl daemon-reload
sudo systemctl <span class="nb">enable</span> kubelet
sudo systemctl start kubelet
sudo systemctl status kubelet
</pre></div>

<h3 id="kube-proxy">Kube-Proxy<a class="headerlink" href="#kube-proxy" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="c1"># You can configure the kube-proxy service like so. Run these commands on both worker nodes:</span>
sudo mv kube-proxy.kubeconfig /var/lib/kube-proxy/kubeconfig

<span class="c1"># Create the kube-proxy config file:</span>
cat <span class="s">&lt;&lt; EOF | sudo tee /var/lib/kube-proxy/kube-proxy-config.yaml</span>
<span class="s">kind: KubeProxyConfiguration</span>
<span class="s">apiVersion: kubeproxy.config.k8s.io/v1alpha1</span>
<span class="s">clientConnection:</span>
<span class="s">  kubeconfig: &quot;/var/lib/kube-proxy/kubeconfig&quot;</span>
<span class="s">mode: &quot;iptables&quot;</span>
<span class="s">clusterCIDR: &quot;10.200.0.0/16&quot;</span>
<span class="s">EOF</span>

<span class="c1"># Create the kube-proxy unit file:</span>
cat <span class="s">&lt;&lt; EOF | sudo tee /etc/systemd/system/kube-proxy.service</span>
<span class="s">[Unit]</span>
<span class="s">Description=Kubernetes Kube Proxy</span>
<span class="s">Documentation=https://github.com/kubernetes/kubernetes</span>

<span class="s">[Service]</span>
<span class="s">ExecStart=/usr/local/bin/kube-proxy \\</span>
<span class="s">  --config=/var/lib/kube-proxy/kube-proxy-config.yaml</span>
<span class="s">Restart=on-failure</span>
<span class="s">RestartSec=5</span>

<span class="s">[Install]</span>
<span class="s">WantedBy=multi-user.target</span>
<span class="s">EOF</span>


sudo systemctl daemon-reload
sudo systemctl <span class="nb">enable</span> kube-proxy
sudo systemctl start kube-proxy
sudo systemctl status kube-proxy
</pre></div>

<h2 id="commands">Commands<a class="headerlink" href="#commands" title="Permanent link">&para;</a></h2>
<h3 id="components-status">Components Status<a class="headerlink" href="#components-status" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="c1"># Use kubectl to check componentstatuses:</span>

kubectl get componentstatuses --kubeconfig admin.kubeconfig

<span class="c1"># You should get output that looks like this:</span>

NAME                 STATUS    MESSAGE              ERROR
controller-manager   Healthy   ok
scheduler            Healthy   ok
etcd-0               Healthy   <span class="o">{</span><span class="s2">&quot;health&quot;</span>: <span class="s2">&quot;true&quot;</span><span class="o">}</span>
etcd-1               Healthy   <span class="o">{</span><span class="s2">&quot;health&quot;</span>: <span class="s2">&quot;true&quot;</span><span class="o">}</span>
</pre></div>

<h2 id="enable-http-health-checks">Enable HTTP Health Checks<a class="headerlink" href="#enable-http-health-checks" title="Permanent link">&para;</a></h2>
<h3 id="using-nginx-load-balancer">Using Nginx Load Balancer<a class="headerlink" href="#using-nginx-load-balancer" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>On Master Nodes</strong></li>
</ul>
<div class="codehilite"><pre><span></span><span class="c1"># You can set up a basic nginx proxy for the healthz endpoint by first installing nginx&quot;</span>
sudo apt-get install -y nginx

<span class="c1"># Create an nginx configuration for the health check proxy:</span>
cat &gt; kubernetes.default.svc.cluster.local <span class="s">&lt;&lt; EOF</span>
<span class="s">server {</span>
<span class="s">  listen      80;</span>
<span class="s">  server_name kubernetes.default.svc.cluster.local;</span>

<span class="s">  location /healthz {</span>
<span class="s">     proxy_pass                    https://127.0.0.1:6443/healthz;</span>
<span class="s">     proxy_ssl_trusted_certificate /var/lib/kubernetes/ca.pem;</span>
<span class="s">  }</span>
<span class="s">}</span>
<span class="s">EOF</span>

<span class="c1"># Set up the proxy configuration so that it is loaded by nginx:</span>
sudo mv kubernetes.default.svc.cluster.local /etc/nginx/sites-available/kubernetes.default.svc.cluster.local
sudo ln -s /etc/nginx/sites-available/kubernetes.default.svc.cluster.local /etc/nginx/sites-enabled/
sudo systemctl restart nginx
sudo systemctl <span class="nb">enable</span> nginx

<span class="c1"># You can verify that everything is working like so:</span>
curl -H <span class="s2">&quot;Host: kubernetes.default.svc.cluster.local&quot;</span> -i http://127.0.0.1/healthz
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../security/" title="Security" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Security
              </span>
            </div>
          </a>
        
        
          <a href="../kops/" title="Kops" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Kops
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 Fabio Santos
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.dc02f8ce.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script>
      
        <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
      
    
  </body>
</html>